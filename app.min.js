(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function orderMinMax(that){if(typeof that!=="undefined"&&typeof that.min!=="undefined"&&typeof that.max!=="undefined"&&that.min>that.max){var tmp=that.min;that.min=that.max;that.max=tmp}return that}function mean(array){var dimension=arguments.length<=1||arguments[1]===undefined?0:arguments[1];return array.reduce(function(p,q){return p+q[dimension]},0)/array.length}var SyncClient=exports.SyncClient=function(){function SyncClient(getTimeFunction){var options=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];_classCallCheck(this,SyncClient);this.pingTimeoutDelay=options.pingTimeoutDelay||{min:1,max:30};orderMinMax(this.pingTimeoutDelay);this.pingTravelDurationAccepted=options.pingTravelDurationAccepted||.5;this.pingStreakIterations=options.pingStreakIterations||10;this.pingStreakPeriod=options.pingStreakPeriod||.25;this.pingStreakDelay=options.pingStreakDelay||{min:10,max:20};orderMinMax(this.pingStreakDelay);this.pingDelay=0;this.pingTimeoutId=0;this.pingId=0;this.pingStreakCount=0;this.streakData=[];this.streakDataNextIndex=0;this.streakDataLength=this.pingStreakIterations;this.longTermDataTrainingDuration=options.longTermDataTrainingDuration||120;this.longTermDataDuration=options.longTermDataDuration||900;this.longTermDataLength=Math.max(2,this.longTermDataDuration/(.5*(this.pingStreakDelay.min+this.pingStreakDelay.max)));this.longTermData=[];this.longTermDataNextIndex=0;this.timeOffset=0;this.travelDuration=0;this.travelDurationMin=0;this.travelDurationMax=0;this.serverTimeReference=0;this.clientTimeReference=0;this.frequencyRatio=1;this.pingTimeoutDelay.current=this.pingTimeoutDelay.min;this.getTimeFunction=getTimeFunction;this.status="new";this.statusChangedTime=0;this.connectionStatus="offline";this.connectionStatusChangedTime=0}_createClass(SyncClient,[{key:"setStatus",value:function setStatus(status){if(status!==this.status){this.status=status;this.statusChangedTime=this.getLocalTime()}return this}},{key:"getStatusDuration",value:function getStatusDuration(){return Math.max(0,this.getLocalTime()-this.statusChangedTime)}},{key:"setConnectionStatus",value:function setConnectionStatus(connectionStatus){if(connectionStatus!==this.connectionStatus){this.connectionStatus=connectionStatus;this.connectionStatusChangedTime=this.getLocalTime()}return this}},{key:"getConnectionStatusDuration",value:function getConnectionStatusDuration(){return Math.max(0,this.getLocalTime()-this.connectionStatusChangedTime)}},{key:"reportStatus",value:function reportStatus(reportFunction){if(typeof reportFunction!=="undefined"){reportFunction({msg:"sync:status",status:this.status,statusDuration:this.getStatusDuration(),timeOffset:this.timeOffset,frequencyRatio:this.frequencyRatio,connection:this.connectionStatus,connectionDuration:this.getConnectionStatusDuration(),connectionTimeOut:this.pingTimeoutDelay.current,travelDuration:this.travelDuration,travelDurationMin:this.travelDurationMin,travelDurationMax:this.travelDurationMax})}}},{key:"__syncLoop",value:function __syncLoop(sendFunction,reportFunction){var _this=this;clearTimeout(this.timeoutId);++this.pingId;sendFunction({msg:"sync:ping",args:[this.pingId,this.getLocalTime()]});this.timeoutId=setTimeout(function(){_this.pingTimeoutDelay.current=Math.min(_this.pingTimeoutDelay.current*2,_this.pingTimeoutDelay.max);_this.setConnectionStatus("offline");_this.reportStatus(reportFunction);_this.__syncLoop(sendFunction,reportFunction)},1e3*this.pingTimeoutDelay.current)}},{key:"start",value:function start(sendFunction,receiveFunction,reportFunction){var _this2=this;this.setStatus("startup");this.setConnectionStatus("offline");this.streakData=[];this.streakDataNextIndex=0;this.longTermData=[];this.longTermDataNextIndex=0;receiveFunction("data",function(data){if(data.msg=="sync:pong"){var pingId=data.args[0];var clientPingTime=data.args[1];var serverPingTime=data.args[2];var serverPongTime=data.args[3];if(pingId===_this2.pingId){++_this2.pingStreakCount;clearTimeout(_this2.timeoutId);_this2.setConnectionStatus("online");_this2.pingTimeoutDelay.current=Math.max(_this2.pingTimeoutDelay.current*.75,_this2.pingTimeoutDelay.min);var clientPongTime=_this2.getLocalTime();var clientTime=.5*(clientPongTime+clientPingTime);var serverTime=.5*(serverPongTime+serverPingTime);var travelDuration=Math.max(0,clientPongTime-clientPingTime-(serverPongTime-serverPingTime));var offsetTime=serverTime-clientTime;_this2.streakData[_this2.streakDataNextIndex]=[travelDuration,offsetTime,clientTime,serverTime];_this2.streakDataNextIndex=++_this2.streakDataNextIndex%_this2.streakDataLength;if(_this2.pingStreakCount>=_this2.pingStreakIterations&&_this2.streakData.length>=_this2.streakDataLength){_this2.pingDelay=_this2.pingStreakDelay.min+Math.random()*(_this2.pingStreakDelay.max-_this2.pingStreakDelay.min);_this2.pingStreakCount=0;var sorted=_this2.streakData.slice(0).sort();var streakTravelDuration=sorted[0][0];var s=0;while(s<sorted.length&&sorted[s][0]<=streakTravelDuration*1.01){++s}s=Math.max(0,s-1);var median=Math.floor(s/2);var streakClientTime=sorted[median][2];var streakServerTime=sorted[median][3];var streakClientSquaredTime=streakClientTime*streakClientTime;var streakClientServerTime=streakClientTime*streakServerTime;_this2.longTermData[_this2.longTermDataNextIndex]=[streakTravelDuration,streakClientTime,streakServerTime,streakClientSquaredTime,streakClientServerTime];_this2.longTermDataNextIndex=++_this2.longTermDataNextIndex%_this2.longTermDataLength;var aroundMedian=sorted.slice(Math.max(0,median-1),Math.min(sorted.length,median+1));_this2.timeOffset=mean(aroundMedian,3)-mean(aroundMedian,2);if(_this2.status==="startup"||_this2.status==="training"&&_this2.getStatusDuration()<_this2.longTermDataTrainingDuration){_this2.serverTimeReference=_this2.timeOffset;_this2.clientTimeReference=0;_this2.frequencyRatio=1;_this2.setStatus("training")}if(_this2.status==="training"&&_this2.getStatusDuration()>=_this2.longTermDataTrainingDuration||_this2.status==="sync"){var regClientTime=mean(_this2.longTermData,1);var regServerTime=mean(_this2.longTermData,2);var regClientSquaredTime=mean(_this2.longTermData,3);var regClientServerTime=mean(_this2.longTermData,4);var covariance=regClientServerTime-regClientTime*regServerTime;var variance=regClientSquaredTime-regClientTime*regClientTime;if(variance>0){_this2.frequencyRatio=covariance/variance;_this2.clientTimeReference=regClientTime;_this2.serverTimeReference=regServerTime;if(_this2.frequencyRatio>.99&&_this2.frequencyRatio<1.01){_this2.setStatus("sync")}else{_this2.serverTimeReference=_this2.timeOffset;_this2.clientTimeReference=0;_this2.frequencyRatio=1;_this2.setStatus("training");_this2.longTermData[0]=[streakTravelDuration,streakClientTime,streakServerTime,streakClientSquaredTime,streakClientServerTime];_this2.longTermData.length=1;_this2.longTermDataNextIndex=1}}}_this2.travelDuration=mean(sorted,0);_this2.travelDurationMin=sorted[0][0];_this2.travelDurationMax=sorted[sorted.length-1][0];_this2.reportStatus(reportFunction)}else{_this2.pingDelay=_this2.pingStreakPeriod}_this2.timeoutId=setTimeout(function(){_this2.__syncLoop(sendFunction,reportFunction)},1e3*_this2.pingDelay)}}});this.__syncLoop(sendFunction,reportFunction)}},{key:"getLocalTime",value:function getLocalTime(syncTime){if(typeof syncTime!=="undefined"){return this.clientTimeReference+(syncTime-this.serverTimeReference)/this.frequencyRatio}else{return this.getTimeFunction()}}},{key:"getSyncTime",value:function getSyncTime(){var localTime=arguments.length<=0||arguments[0]===undefined?this.getLocalTime():arguments[0];return this.serverTimeReference+this.frequencyRatio*(localTime-this.clientTimeReference)}}]);return SyncClient}()},{}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var SyncServer=exports.SyncServer=function(){function SyncServer(getTimeFunction){_classCallCheck(this,SyncServer);this.getTimeFunction=getTimeFunction}_createClass(SyncServer,[{key:"start",value:function start(sendFunction,receiveFunction){var _this=this;receiveFunction("data",function(obj){console.log("----",obj);if(obj.msg==="sync:ping"){var id=obj.args[0];var clientPingTime=obj.args[1];var serverPingTime=_this.getLocalTime();console.log("send !",{msg:"sync:pong",args:[id,clientPingTime,serverPingTime,_this.getLocalTime()]});sendFunction({msg:"sync:pong",args:[id,clientPingTime,serverPingTime,_this.getLocalTime()]})}})}},{key:"getLocalTime",value:function getLocalTime(syncTime){if(typeof syncTime!=="undefined"){return syncTime}else{return this.getTimeFunction()}}},{key:"getSyncTime",value:function getSyncTime(localTime){return this.getLocalTime(localTime)}}]);return SyncServer}()},{}],3:[function(require,module,exports){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _loadSamples=require("./loadSamples");var _SyncServer=require("./SyncServer.js");var _SyncClient=require("./SyncClient.js");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var StateMachine=require("fsm-as-promised");var wavesAudio=require("waves-audio");var audioContext=wavesAudio.audioContext;var $connectScreen=document.querySelector("#connect");var $playScreen=document.querySelector("#play");var $latency=document.querySelector("#latency");$connectScreen.style.display="none";$playScreen.style.display="none";var $peer=document.querySelector("#peer");var $createPeerBtn=document.querySelector("#create");var $joinPeerBtn=document.querySelector("#join");var $resetBtn=document.querySelector("#reset");var samplePlayer=void 0;var peerContext=void 0;var sampleURLS=["./media/bass-1.mp3","./media/bass-2.mp3","./media/bass-3.mp3","./media/drums1-1.mp3","./media/drums1-2.mp3","./media/drums1-3.mp3","./media/drums2-1.mp3","./media/drums2-2.mp3","./media/drums3-1.mp3","./media/drums3-2.mp3","./media/drums3-3.mp3","./media/fx-1.mp3","./media/guitar-1.mp3","./media/guitar-2.mp3","./media/synths-1.mp3","./media/synths-10.mp3","./media/synths-11.mp3","./media/synths-2.mp3","./media/synths-3.mp3","./media/synths-4.mp3","./media/synths-5.mp3","./media/synths-6.mp3","./media/synths-7.mp3","./media/synths-8.mp3","./media/synths-9.mp3","./media/voice-1.mp3","./media/voice-2.mp3","./media/voice-3.mp3","./media/voice-4.mp3","./media/voice-5.mp3"];var fsm=StateMachine({initial:"init",events:[{name:"Init",from:"init",to:"initialized"},{name:"CreatePeer",from:"initialized",to:"peerCreated"},{name:"JoinPeer",from:"initialized",to:"peerJoined"},{name:"Play",from:["peerJoined","peerCreated"],to:"play"},{name:"Reset",from:"play",to:"init"}],callbacks:{onInit:function onInit(options){return new Promise(function(resolve,reject){(0,_loadSamples.loadSamples)(sampleURLS).then(function(samples){samplePlayer=new SamplePlayer(samples);$connectScreen.style.display="block";resolve(options)})})},onCreatePeer:function onCreatePeer(options){$connectScreen.style.display="none";var peerID=options.args[0];peerContext=new PeerMasterContext(peerID);return options},onJoinPeer:function onJoinPeer(options){$connectScreen.style.display="none";var peerID=options.args[0];peerContext=new PeerSlaveContext(peerID);return options},onPlay:function onPlay(options){samplePlayer.peerContext=peerContext;$playScreen.style.display="block";return options}}});fsm.Init();$createPeerBtn.addEventListener("click",function(){fsm.CreatePeer($peer.value)});$joinPeerBtn.addEventListener("click",function(){fsm.JoinPeer($peer.value)});$resetBtn.addEventListener("click",function(){document.location.reload()});var SamplePlayer=function(){function SamplePlayer(samples){_classCallCheck(this,SamplePlayer);this.samples=samples;this.currentSource=undefined;this.buildPads()}_createClass(SamplePlayer,[{key:"buildPads",value:function buildPads(){var _this=this;var _loop=function _loop(i){var $pad=document.createElement("button");var sampleName=sampleURLS[i].split(".")[1].split("/")[2];$pad.classList.add(sampleName);$pad.classList.add("sample-"+i);$pad.classList.add("sample");$pad.textContent=sampleName;$pad.addEventListener("click",function(){_this.play(i)},false);$playScreen.insertBefore($pad,$resetBtn)};for(var i=0;i<this.samples.length;i++){_loop(i)}}},{key:"play",value:function play(padID){if(this.currentSource){this.currentSource.stop()}var source=audioContext.createBufferSource();this.currentSource=source;this.currentAudioBuffer=this.samples[padID];source.loop=true;source.connect(audioContext.destination);source.buffer=this.currentAudioBuffer;console.log("this.offset and latency",this.offset);source.start(0,this.offset);var $allSamples=document.querySelectorAll(".sample");for(var i=0;i<$allSamples.length;++i){$allSamples[i].style["background-color"]="white"}var $target=document.querySelector(".sample-"+padID);$target.style["background-color"]="red"}},{key:"offset",get:function get(){var offset=0;var latency=parseInt($latency.value)/1e3;console.log(latency);if(this.peerContext.type=="master"){if(!this.syncTimeBegin){this.syncTimeBegin=audioContext.currentTime;this.peerContext.shared["syncTimeBegin"]=this.syncTimeBegin}var syncTime=audioContext.currentTime;var nbLoop=parseInt((syncTime-this.syncTimeBegin)/this.currentAudioBuffer.duration);var lastBeginTime=this.syncTimeBegin+nbLoop*this.currentAudioBuffer.duration;offset=syncTime-lastBeginTime}else{var syncTimeBeginFromMaster=this.peerContext.shared["syncTimeBeginFromMaster"];var _syncTime=this.peerContext.syncSlave.getSyncTime();var _nbLoop=parseInt((_syncTime-syncTimeBeginFromMaster)/this.currentAudioBuffer.duration);var _lastBeginTime=syncTimeBeginFromMaster+_nbLoop*this.currentAudioBuffer.duration;offset=_syncTime-_lastBeginTime}offset=offset+latency;while(offset<0){offset=offset+this.currentAudioBuffer.duration}return offset}},{key:"peerContext",set:function set(pC){this._peerContext=pC},get:function get(){return this._peerContext}}]);return SamplePlayer}();var PeerMasterContext=function(){function PeerMasterContext(peerID){var _this2=this;_classCallCheck(this,PeerMasterContext);this.shared={};this.shared["connectedPeers"]={};this.peer=new Peer(peerID,{key:"ubgje3sm5p0evcxr",debug:3,logFunction:function logFunction(){var copy=Array.prototype.slice.call(arguments).join(" ");console.log(copy)}});this.peer.on("open",function(id){fsm.Play();_this2.peerMasterSync()});this.type="master"}_createClass(PeerMasterContext,[{key:"peerMasterSync",value:function peerMasterSync(){var getTimeFunction=function getTimeFunction(){return audioContext.currentTime};this.syncMaster=new _SyncServer.SyncServer(getTimeFunction);this.peer.on("connection",this.slaveConnect.bind(this))}},{key:"slaveConnect",value:function slaveConnect(conn){var connectedPeers=this.shared["connectedPeers"];connectedPeers[conn.peer]=conn;var sendFunction=conn.send.bind(conn);var receiveFunction=conn.on.bind(conn);var syncTimeBegin=this.shared["syncTimeBegin"];sendFunction({msg:"sync:syncTimeBegin",args:[syncTimeBegin]});this.syncMaster.start(sendFunction,receiveFunction);conn.on("data",this.peerMasterDataListener.bind(this)(conn,this))}},{key:"peerMasterDataListener",value:function peerMasterDataListener(conn,that){return function(data){if(data.msg=="sync:newPeer"){that.shared["connectedPeers"][data.args[0]]=conn;var syncTimeBegin=that.shared["syncTimeBegin"];conn.send({msg:"sync:syncTimeBegin",args:[syncTimeBegin]})}}}}]);return PeerMasterContext}();var PeerSlaveContext=function(){function PeerSlaveContext(peerID){var _this3=this;_classCallCheck(this,PeerSlaveContext);this.shared={};this.shared["connectedPeers"]={};var peer=new Peer({key:"ubgje3sm5p0evcxr",debug:3,logFunction:function logFunction(){var copy=Array.prototype.slice.call(arguments).join(" ");console.log(copy)}});var conn=peer.connect(peerID);this.shared["conn"]=conn;peer.on("error",function(err){console.log(err)});conn.on("open",function(){_this3.sync="slave";_this3.peerSlaveSync()});this.type="slave"}_createClass(PeerSlaveContext,[{key:"peerSlaveSync",value:function peerSlaveSync(){var conn=this.shared["conn"];var connectedPeers=this.shared["connectedPeers"];connectedPeers[conn.peer]=1;conn.send({msg:"sync:newPeer",args:[conn.peer]});var getTimeFunction=function getTimeFunction(){return audioContext.currentTime};var sendFunction=conn.send.bind(conn);var receiveFunction=conn.on.bind(conn);var reportFunction=this.syncSlave.bind(this);this.syncSlave=new _SyncClient.SyncClient(getTimeFunction);this.syncSlave.start(sendFunction,receiveFunction,reportFunction);this.shared["sync"]=this.syncSlave;conn.on("data",this.peerSlaveDataListener.bind(this));conn.on("close",function(){$peer.value="";document.location.reload()})}},{key:"syncSlave",value:function syncSlave(obj){fsm.Play();this.syncTime=obj.timeOffset}},{key:"peerSlaveDataListener",value:function peerSlaveDataListener(data){if(data.msg=="sync:syncTimeBegin"){var syncTimeBeginFromMaster=data.args[0];this.shared["syncTimeBeginFromMaster"]=syncTimeBeginFromMaster}if(data.msg=="sample:change"){this.sampleChange(data)}}}]);return PeerSlaveContext}()},{"./SyncClient.js":1,"./SyncServer.js":2,"./loadSamples":5,"fsm-as-promised":7,"waves-audio":29}],4:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadSample=loadSample;var wavesAudio=require("waves-audio");var audioContext=wavesAudio.audioContext;function loadSample(url){return new Promise(function(resolve,reject){fetch(url).then(function(response){return response.arrayBuffer()}).then(function(buffer){audioContext.decodeAudioData(buffer,function(decodedAudioData){resolve(decodedAudioData)})})})}},{"waves-audio":29}],5:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadSamples=loadSamples;var _loadSample=require("./loadSample");function loadSamples(urls){return Promise.all(urls.map(function(soundURL){return(0,_loadSample.loadSample)(soundURL)}))}},{"./loadSample":4}],6:[function(require,module,exports){(function(process,global){(function(){"use strict";function lib$es6$promise$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function lib$es6$promise$utils$$isFunction(x){return typeof x==="function"}function lib$es6$promise$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var lib$es6$promise$utils$$_isArray;if(!Array.isArray){lib$es6$promise$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{lib$es6$promise$utils$$_isArray=Array.isArray}var lib$es6$promise$utils$$isArray=lib$es6$promise$utils$$_isArray;var lib$es6$promise$asap$$len=0;var lib$es6$promise$asap$$vertxNext;var lib$es6$promise$asap$$customSchedulerFn;var lib$es6$promise$asap$$asap=function asap(callback,arg){lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len]=callback;lib$es6$promise$asap$$queue[lib$es6$promise$asap$$len+1]=arg;lib$es6$promise$asap$$len+=2;if(lib$es6$promise$asap$$len===2){if(lib$es6$promise$asap$$customSchedulerFn){lib$es6$promise$asap$$customSchedulerFn(lib$es6$promise$asap$$flush)}else{lib$es6$promise$asap$$scheduleFlush()}}};function lib$es6$promise$asap$$setScheduler(scheduleFn){lib$es6$promise$asap$$customSchedulerFn=scheduleFn}function lib$es6$promise$asap$$setAsap(asapFn){lib$es6$promise$asap$$asap=asapFn}var lib$es6$promise$asap$$browserWindow=typeof window!=="undefined"?window:undefined;var lib$es6$promise$asap$$browserGlobal=lib$es6$promise$asap$$browserWindow||{};var lib$es6$promise$asap$$BrowserMutationObserver=lib$es6$promise$asap$$browserGlobal.MutationObserver||lib$es6$promise$asap$$browserGlobal.WebKitMutationObserver;var lib$es6$promise$asap$$isNode=typeof process!=="undefined"&&{}.toString.call(process)==="[object process]";var lib$es6$promise$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function lib$es6$promise$asap$$useNextTick(){return function(){process.nextTick(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useVertxTimer(){return function(){lib$es6$promise$asap$$vertxNext(lib$es6$promise$asap$$flush)}}function lib$es6$promise$asap$$useMutationObserver(){var iterations=0;var observer=new lib$es6$promise$asap$$BrowserMutationObserver(lib$es6$promise$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function lib$es6$promise$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=lib$es6$promise$asap$$flush;return function(){channel.port2.postMessage(0)}}function lib$es6$promise$asap$$useSetTimeout(){return function(){setTimeout(lib$es6$promise$asap$$flush,1)}}var lib$es6$promise$asap$$queue=new Array(1e3);function lib$es6$promise$asap$$flush(){for(var i=0;i<lib$es6$promise$asap$$len;i+=2){var callback=lib$es6$promise$asap$$queue[i];var arg=lib$es6$promise$asap$$queue[i+1];callback(arg);lib$es6$promise$asap$$queue[i]=undefined;lib$es6$promise$asap$$queue[i+1]=undefined}lib$es6$promise$asap$$len=0}function lib$es6$promise$asap$$attemptVertx(){try{var r=require;var vertx=r("vertx");lib$es6$promise$asap$$vertxNext=vertx.runOnLoop||vertx.runOnContext;return lib$es6$promise$asap$$useVertxTimer()}catch(e){return lib$es6$promise$asap$$useSetTimeout()}}var lib$es6$promise$asap$$scheduleFlush;if(lib$es6$promise$asap$$isNode){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useNextTick()}else if(lib$es6$promise$asap$$BrowserMutationObserver){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMutationObserver()}else if(lib$es6$promise$asap$$isWorker){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useMessageChannel()}else if(lib$es6$promise$asap$$browserWindow===undefined&&typeof require==="function"){lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$attemptVertx()}else{lib$es6$promise$asap$$scheduleFlush=lib$es6$promise$asap$$useSetTimeout()}function lib$es6$promise$then$$then(onFulfillment,onRejection){var parent=this;var state=parent._state;if(state===lib$es6$promise$$internal$$FULFILLED&&!onFulfillment||state===lib$es6$promise$$internal$$REJECTED&&!onRejection){return this}var child=new this.constructor(lib$es6$promise$$internal$$noop);var result=parent._result;if(state){var callback=arguments[state-1];lib$es6$promise$asap$$asap(function(){lib$es6$promise$$internal$$invokeCallback(state,child,callback,result)})}else{lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child}var lib$es6$promise$then$$default=lib$es6$promise$then$$then;function lib$es6$promise$promise$resolve$$resolve(object){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$resolve(promise,object);return promise}var lib$es6$promise$promise$resolve$$default=lib$es6$promise$promise$resolve$$resolve;function lib$es6$promise$$internal$$noop(){}var lib$es6$promise$$internal$$PENDING=void 0;var lib$es6$promise$$internal$$FULFILLED=1;var lib$es6$promise$$internal$$REJECTED=2;var lib$es6$promise$$internal$$GET_THEN_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$selfFulfillment(){return new TypeError("You cannot resolve a promise with itself")}function lib$es6$promise$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function lib$es6$promise$$internal$$getThen(promise){try{return promise.then}catch(error){lib$es6$promise$$internal$$GET_THEN_ERROR.error=error;return lib$es6$promise$$internal$$GET_THEN_ERROR}}function lib$es6$promise$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function lib$es6$promise$$internal$$handleForeignThenable(promise,thenable,then){lib$es6$promise$asap$$asap(function(promise){var sealed=false;var error=lib$es6$promise$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){lib$es6$promise$$internal$$resolve(promise,value)}else{lib$es6$promise$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;lib$es6$promise$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;lib$es6$promise$$internal$$reject(promise,error)}},promise)}function lib$es6$promise$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,thenable._result)}else if(thenable._state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,thenable._result)}else{lib$es6$promise$$internal$$subscribe(thenable,undefined,function(value){lib$es6$promise$$internal$$resolve(promise,value)},function(reason){lib$es6$promise$$internal$$reject(promise,reason)})}}function lib$es6$promise$$internal$$handleMaybeThenable(promise,maybeThenable,then){if(maybeThenable.constructor===promise.constructor&&then===lib$es6$promise$then$$default&&constructor.resolve===lib$es6$promise$promise$resolve$$default){lib$es6$promise$$internal$$handleOwnThenable(promise,maybeThenable)}else{if(then===lib$es6$promise$$internal$$GET_THEN_ERROR){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}else if(lib$es6$promise$utils$$isFunction(then)){lib$es6$promise$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{lib$es6$promise$$internal$$fulfill(promise,maybeThenable)}}}function lib$es6$promise$$internal$$resolve(promise,value){if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$selfFulfillment())}else if(lib$es6$promise$utils$$objectOrFunction(value)){lib$es6$promise$$internal$$handleMaybeThenable(promise,value,lib$es6$promise$$internal$$getThen(value))}else{lib$es6$promise$$internal$$fulfill(promise,value)}}function lib$es6$promise$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}lib$es6$promise$$internal$$publish(promise)}function lib$es6$promise$$internal$$fulfill(promise,value){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._result=value;promise._state=lib$es6$promise$$internal$$FULFILLED;if(promise._subscribers.length!==0){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,promise)}}function lib$es6$promise$$internal$$reject(promise,reason){if(promise._state!==lib$es6$promise$$internal$$PENDING){return}promise._state=lib$es6$promise$$internal$$REJECTED;promise._result=reason;lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publishRejection,promise)}function lib$es6$promise$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+lib$es6$promise$$internal$$FULFILLED]=onFulfillment;subscribers[length+lib$es6$promise$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){lib$es6$promise$asap$$asap(lib$es6$promise$$internal$$publish,parent)}}function lib$es6$promise$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){lib$es6$promise$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function lib$es6$promise$$internal$$ErrorObject(){this.error=null}var lib$es6$promise$$internal$$TRY_CATCH_ERROR=new lib$es6$promise$$internal$$ErrorObject;function lib$es6$promise$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){lib$es6$promise$$internal$$TRY_CATCH_ERROR.error=e;return lib$es6$promise$$internal$$TRY_CATCH_ERROR}}function lib$es6$promise$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=lib$es6$promise$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=lib$es6$promise$$internal$$tryCatch(callback,detail);if(value===lib$es6$promise$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){lib$es6$promise$$internal$$reject(promise,lib$es6$promise$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==lib$es6$promise$$internal$$PENDING){}else if(hasCallback&&succeeded){lib$es6$promise$$internal$$resolve(promise,value)}else if(failed){lib$es6$promise$$internal$$reject(promise,error)}else if(settled===lib$es6$promise$$internal$$FULFILLED){lib$es6$promise$$internal$$fulfill(promise,value)}else if(settled===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}}function lib$es6$promise$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){lib$es6$promise$$internal$$resolve(promise,value)},function rejectPromise(reason){lib$es6$promise$$internal$$reject(promise,reason)})}catch(e){lib$es6$promise$$internal$$reject(promise,e)}}function lib$es6$promise$promise$all$$all(entries){return new lib$es6$promise$enumerator$$default(this,entries).promise}var lib$es6$promise$promise$all$$default=lib$es6$promise$promise$all$$all;function lib$es6$promise$promise$race$$race(entries){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);if(!lib$es6$promise$utils$$isArray(entries)){lib$es6$promise$$internal$$reject(promise,new TypeError("You must pass an array to race."));
return promise}var length=entries.length;function onFulfillment(value){lib$es6$promise$$internal$$resolve(promise,value)}function onRejection(reason){lib$es6$promise$$internal$$reject(promise,reason)}for(var i=0;promise._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){lib$es6$promise$$internal$$subscribe(Constructor.resolve(entries[i]),undefined,onFulfillment,onRejection)}return promise}var lib$es6$promise$promise$race$$default=lib$es6$promise$promise$race$$race;function lib$es6$promise$promise$reject$$reject(reason){var Constructor=this;var promise=new Constructor(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$reject(promise,reason);return promise}var lib$es6$promise$promise$reject$$default=lib$es6$promise$promise$reject$$reject;var lib$es6$promise$promise$$counter=0;function lib$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function lib$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var lib$es6$promise$promise$$default=lib$es6$promise$promise$$Promise;function lib$es6$promise$promise$$Promise(resolver){this._id=lib$es6$promise$promise$$counter++;this._state=undefined;this._result=undefined;this._subscribers=[];if(lib$es6$promise$$internal$$noop!==resolver){typeof resolver!=="function"&&lib$es6$promise$promise$$needsResolver();this instanceof lib$es6$promise$promise$$Promise?lib$es6$promise$$internal$$initializePromise(this,resolver):lib$es6$promise$promise$$needsNew()}}lib$es6$promise$promise$$Promise.all=lib$es6$promise$promise$all$$default;lib$es6$promise$promise$$Promise.race=lib$es6$promise$promise$race$$default;lib$es6$promise$promise$$Promise.resolve=lib$es6$promise$promise$resolve$$default;lib$es6$promise$promise$$Promise.reject=lib$es6$promise$promise$reject$$default;lib$es6$promise$promise$$Promise._setScheduler=lib$es6$promise$asap$$setScheduler;lib$es6$promise$promise$$Promise._setAsap=lib$es6$promise$asap$$setAsap;lib$es6$promise$promise$$Promise._asap=lib$es6$promise$asap$$asap;lib$es6$promise$promise$$Promise.prototype={constructor:lib$es6$promise$promise$$Promise,then:lib$es6$promise$then$$default,"catch":function(onRejection){return this.then(null,onRejection)}};var lib$es6$promise$enumerator$$default=lib$es6$promise$enumerator$$Enumerator;function lib$es6$promise$enumerator$$Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(lib$es6$promise$$internal$$noop);if(Array.isArray(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){lib$es6$promise$$internal$$fulfill(this.promise,this._result)}}}else{lib$es6$promise$$internal$$reject(this.promise,this._validationError())}}lib$es6$promise$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};lib$es6$promise$enumerator$$Enumerator.prototype._enumerate=function(){var length=this.length;var input=this._input;for(var i=0;this._state===lib$es6$promise$$internal$$PENDING&&i<length;i++){this._eachEntry(input[i],i)}};lib$es6$promise$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;var resolve=c.resolve;if(resolve===lib$es6$promise$promise$resolve$$default){var then=lib$es6$promise$$internal$$getThen(entry);if(then===lib$es6$promise$then$$default&&entry._state!==lib$es6$promise$$internal$$PENDING){this._settledAt(entry._state,i,entry._result)}else if(typeof then!=="function"){this._remaining--;this._result[i]=entry}else if(c===lib$es6$promise$promise$$default){var promise=new c(lib$es6$promise$$internal$$noop);lib$es6$promise$$internal$$handleMaybeThenable(promise,entry,then);this._willSettleAt(promise,i)}else{this._willSettleAt(new c(function(resolve){resolve(entry)}),i)}}else{this._willSettleAt(resolve(entry),i)}};lib$es6$promise$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===lib$es6$promise$$internal$$PENDING){this._remaining--;if(state===lib$es6$promise$$internal$$REJECTED){lib$es6$promise$$internal$$reject(promise,value)}else{this._result[i]=value}}if(this._remaining===0){lib$es6$promise$$internal$$fulfill(promise,this._result)}};lib$es6$promise$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;lib$es6$promise$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt(lib$es6$promise$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt(lib$es6$promise$$internal$$REJECTED,i,reason)})};function lib$es6$promise$polyfill$$polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof self!=="undefined"){local=self}else{try{local=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}}var P=local.Promise;if(P&&Object.prototype.toString.call(P.resolve())==="[object Promise]"&&!P.cast){return}local.Promise=lib$es6$promise$promise$$default}var lib$es6$promise$polyfill$$default=lib$es6$promise$polyfill$$polyfill;var lib$es6$promise$umd$$ES6Promise={Promise:lib$es6$promise$promise$$default,polyfill:lib$es6$promise$polyfill$$default};if(typeof define==="function"&&define["amd"]){define(function(){return lib$es6$promise$umd$$ES6Promise})}else if(typeof module!=="undefined"&&module["exports"]){module["exports"]=lib$es6$promise$umd$$ES6Promise}else if(typeof this!=="undefined"){this["ES6Promise"]=lib$es6$promise$umd$$ES6Promise}lib$es6$promise$polyfill$$default()}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:8}],7:[function(require,module,exports){module.exports=StateMachine;try{StateMachine.Promise=Promise}catch(e){StateMachine.Promise=require("es6-promise").Promise}function StateMachine(configuration,target){"use strict";var Promise=StateMachine.Promise,events={},states={},inTransition=false,current,Type={NOOP:0,INTER:1,GENERAL:2};target=target||{};configuration.events=configuration.events||[];configuration.callbacks=configuration.callbacks||{};current=configuration.initial||"none";configuration.events.forEach(function(event){addEvent(event);addState(event.from);addState(event.to)});for(var name in events){Object.defineProperty(target,name,{enumerable:true,value:buildEvent(name),writable:true})}Object.defineProperties(target,{can:{value:can,writable:true},cannot:{value:cannot,writable:true},current:{get:function(){return current}},is:{value:is,writable:true}});function identity(param){return param}function addEvent(event){events[event.name]=events[event.name]||{};if(event.to instanceof Array){throw new Error("Ambigous transition "+event.name)}if(event.to===undefined){event.to=event.from}if(event.from instanceof Array){event.from.forEach(function(from){events[event.name][from]=event.to||events[event.name][from]})}else{events[event.name][event.from]=event.to||events[event.name][event.from]}}function addState(state){function addName(name){states[name]=states[name]||{noopTransition:0}}if(state instanceof Array){state.forEach(addName)}else{addName(state)}}function buildEvent(name){return function(){var args=Array.prototype.slice.call(arguments),callbacks=configuration.callbacks,promise,options={name:name,from:current,to:events[name][current],args:args};promise=new Promise(function(resolve,reject){resolve(options)});function revert(err){switch(type(options)){case Type.INTER:inTransition=false;break;case Type.NOOP:states[current].noopTransition=states[current].noopTransition-1;break;default:}throw err}return promise.then(isValidEvent).then(canTransition).then(callbacks["onleave"+current]?callbacks["onleave"+current].bind(target,options):identity).then(callbacks.onleave?callbacks.onleave.bind(target,options):identity).then(onleavestate.bind(target,options)).then(callbacks["on"+name]?callbacks["on"+name].bind(target,options):identity).then(callbacks["onenter"+events[name][current]]?callbacks["onenter"+events[name][current]].bind(target,options):identity).then(callbacks.onenter?callbacks.onenter.bind(target,options):identity).then(onenterstate.bind(target,options)).then(callbacks["onentered"+events[name][current]]?callbacks["onentered"+events[name][current]].bind(target,options):identity).then(callbacks.onentered?callbacks.onentered.bind(target,options):identity).catch(revert)}}function can(name){return events[name].hasOwnProperty(current)}function cannot(name){return!can(name)}function canTransition(options){switch(type(options)){case Type.NOOP:if(inTransition){throw new Error("Previous transition pending")}break;case Type.INTER:if(states[current].noopTransition>0||inTransition){throw new Error("Previous transition pending")}break;default:}return options}function is(state){return state===current}function isValidEvent(options){if(cannot(options.name)){throw new Error("Invalid event in current state")}return options}function onenterstate(options){switch(type(options)){case Type.NOOP:states[current].noopTransition=states[current].noopTransition-1;break;default:inTransition=false;current=options.to}return options}function onleavestate(options){switch(type(options)){case Type.NOOP:states[current].noopTransition=states[current].noopTransition+1;break;default:inTransition=true}return options}function type(options){if(options.from===options.to||options.to===undefined){return Type.NOOP}else if(options.from==="*"){return Type.GENERAL}else{return Type.INTER}}return target}},{"es6-promise":6}],8:[function(require,module,exports){var process=module.exports={};var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){draining=false;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=setTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=false;clearTimeout(timeout)}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){setTimeout(drainQueue,0)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=true;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],9:[function(require,module,exports){"use strict";(function(global,exports,perf){"use strict";function fixSetTarget(param){if(!param){return}if(!param.setTargetAtTime)param.setTargetAtTime=param.setTargetValueAtTime}if(window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")){window.AudioContext=webkitAudioContext;if(!AudioContext.prototype.hasOwnProperty("createGain"))AudioContext.prototype.createGain=AudioContext.prototype.createGainNode;if(!AudioContext.prototype.hasOwnProperty("createDelay"))AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode;if(!AudioContext.prototype.hasOwnProperty("createScriptProcessor"))AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode;if(!AudioContext.prototype.hasOwnProperty("createPeriodicWave"))AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable;AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain;AudioContext.prototype.createGain=function(){var node=this.internal_createGain();fixSetTarget(node.gain);return node};AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay;AudioContext.prototype.createDelay=function(maxDelayTime){var node=maxDelayTime?this.internal_createDelay(maxDelayTime):this.internal_createDelay();fixSetTarget(node.delayTime);return node};AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource;AudioContext.prototype.createBufferSource=function(){var node=this.internal_createBufferSource();if(!node.start){node.start=function(when,offset,duration){if(offset||duration)this.noteGrainOn(when,offset,duration);else this.noteOn(when)}}if(!node.stop)node.stop=node.noteOff;fixSetTarget(node.playbackRate);return node};AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor;AudioContext.prototype.createDynamicsCompressor=function(){var node=this.internal_createDynamicsCompressor();fixSetTarget(node.threshold);fixSetTarget(node.knee);fixSetTarget(node.ratio);fixSetTarget(node.reduction);fixSetTarget(node.attack);fixSetTarget(node.release);return node};AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter;AudioContext.prototype.createBiquadFilter=function(){var node=this.internal_createBiquadFilter();fixSetTarget(node.frequency);fixSetTarget(node.detune);fixSetTarget(node.Q);fixSetTarget(node.gain);return node};if(AudioContext.prototype.hasOwnProperty("createOscillator")){AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator;AudioContext.prototype.createOscillator=function(){var node=this.internal_createOscillator();if(!node.start)node.start=node.noteOn;if(!node.stop)node.stop=node.noteOff;if(!node.setPeriodicWave)node.setPeriodicWave=node.setWaveTable;fixSetTarget(node.frequency);fixSetTarget(node.detune);return node}}}})(window)},{}],10:[function(require,module,exports){"use strict";require("./ac-monkeypatch");var audioContext;if(window.AudioContext)audioContext=new window.AudioContext;module.exports=audioContext},{"./ac-monkeypatch":9}],11:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var TimeEngine=require("./time-engine");var defaultAudioContext=require("./audio-context");var AudioTimeEngine=function(_TimeEngine){function AudioTimeEngine(){var audioContext=arguments[0]===undefined?defaultAudioContext:arguments[0];_classCallCheck(this,AudioTimeEngine);_get(_core.Object.getPrototypeOf(AudioTimeEngine.prototype),"constructor",this).call(this);this.audioContext=audioContext;this.outputNode=null}_inherits(AudioTimeEngine,_TimeEngine);_createClass(AudioTimeEngine,{connect:{value:function connect(target){this.outputNode.connect(target);return this}},disconnect:{value:function disconnect(connection){this.outputNode.disconnect(connection);return this}}});return AudioTimeEngine}(TimeEngine);module.exports=AudioTimeEngine},{"./audio-context":10,"./time-engine":12,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],12:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var TimeEngine=function(){function TimeEngine(){_classCallCheck(this,TimeEngine);this.master=null;this.outputNode=null}_createClass(TimeEngine,{currentTime:{get:function(){if(this.master)return this.master.currentTime;return undefined}},currentPosition:{get:function(){var master=this.master;if(master&&master.currentPosition!==undefined)return master.currentPosition;return undefined}},implementsScheduled:{value:function implementsScheduled(){return this.advanceTime&&this.advanceTime instanceof Function}},resetTime:{value:function resetTime(){var time=arguments[0]===undefined?undefined:arguments[0];if(this.master)this.master.resetEngineTime(this,time)}},implementsTransported:{value:function implementsTransported(){return this.syncPosition&&this.syncPosition instanceof Function&&this.advancePosition&&this.advancePosition instanceof Function}},resetPosition:{value:function resetPosition(){var position=arguments[0]===undefined?undefined:arguments[0];if(this.master)this.master.resetEnginePosition(this,position)}},implementsSpeedControlled:{value:function implementsSpeedControlled(){return this.syncSpeed&&this.syncSpeed instanceof Function}}});return TimeEngine}();module.exports=TimeEngine},{"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26}],13:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var AudioTimeEngine=require("../core/audio-time-engine");function optOrDef(opt,def){if(opt!==undefined){return opt}return def}var GranularEngine=function(_AudioTimeEngine){function GranularEngine(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,GranularEngine);_get(_core.Object.getPrototypeOf(GranularEngine.prototype),"constructor",this).call(this,options.audioContext);this.buffer=optOrDef(options.buffer,null);this.periodAbs=optOrDef(options.periodAbs,.01);this.periodRel=optOrDef(options.periodRel,0);this.periodVar=optOrDef(options.periodVar,0);this.position=optOrDef(options.position,0);this.positionVar=optOrDef(options.positionVar,.003);this.durationAbs=optOrDef(options.durationAbs,.1);this.durationRel=optOrDef(options.durationRel,0);this.attackAbs=optOrDef(options.attackAbs,0);this.attackRel=optOrDef(options.attackRel,.5);this.attackShape=optOrDef(options.attackShape,"lin");this.releaseAbs=optOrDef(options.releaseAbs,0);this.releaseRel=optOrDef(options.releaseRel,.5);this.releaseShape=optOrDef(options.releaseShape,"lin");this.expRampOffset=optOrDef(options.expRampOffset,1e-4);this.resampling=optOrDef(options.resampling,0);this.resamplingVar=optOrDef(options.resamplingVar,0);this.gain=optOrDef(options.gain,1);this.centered=optOrDef(options.centered,true);this.cyclic=optOrDef(options.cyclic,false);this.wrapAroundExtension=optOrDef(options.wrapAroundExtension,0);this.outputNode=this.audioContext.createGain()}_inherits(GranularEngine,_AudioTimeEngine);_createClass(GranularEngine,{bufferDuration:{get:function(){if(this.buffer){var bufferDuration=this.buffer.duration;if(this.wrapAroundExtension)bufferDuration-=this.wrapAroundExtension;return bufferDuration}return 0}},currentPosition:{get:function(){var master=this.master;if(master&&master.currentPosition!==undefined)return master.currentPosition;return this.position}},advanceTime:{value:function advanceTime(time){time=Math.max(time,this.audioContext.currentTime);return time+this.trigger(time)}},trigger:{value:function trigger(time){var audioContext=this.audioContext;var grainTime=time||audioContext.currentTime;var grainPeriod=this.periodAbs;var grainPosition=this.currentPosition;var grainDuration=this.durationAbs;if(this.buffer){var resamplingRate=1;if(this.resampling!==0||this.resamplingVar>0){var randomResampling=(Math.random()-.5)*2*this.resamplingVar;resamplingRate=Math.pow(2,(this.resampling+randomResampling)/1200)}grainPeriod+=this.periodRel*grainDuration;grainDuration+=this.durationRel*grainPeriod;if(this.periodVar>0)grainPeriod+=2*(Math.random()-.5)*this.periodVar*grainPeriod;if(this.centered)grainPosition-=.5*grainDuration;if(this.positionVar>0)grainPosition+=(2*Math.random()-1)*this.positionVar;var bufferDuration=this.bufferDuration;if(grainPosition<0||grainPosition>=bufferDuration){if(this.cyclic){var cycles=grainPosition/bufferDuration;grainPosition=(cycles-Math.floor(cycles))*bufferDuration;if(grainPosition+grainDuration>this.buffer.duration)grainDuration=this.buffer.duration-grainPosition}else{if(grainPosition<0){grainTime-=grainPosition;grainDuration+=grainPosition;grainPosition=0}if(grainPosition+grainDuration>bufferDuration)grainDuration=bufferDuration-grainPosition}}if(this.gain>0&&grainDuration>=.001){var envelope=audioContext.createGain();var attack=this.attackAbs+this.attackRel*grainDuration;var release=this.releaseAbs+this.releaseRel*grainDuration;if(attack+release>grainDuration){var factor=grainDuration/(attack+release);attack*=factor;release*=factor}var attackEndTime=grainTime+attack;var grainEndTime=grainTime+grainDuration;var releaseStartTime=grainEndTime-release;envelope.gain.value=0;if(this.attackShape==="lin"){envelope.gain.setValueAtTime(0,grainTime);envelope.gain.linearRampToValueAtTime(this.gain,attackEndTime)}else{envelope.gain.setValueAtTime(this.expRampOffset,grainTime);envelope.gain.exponentialRampToValueAtTime(this.gain,attackEndTime)}if(releaseStartTime>attackEndTime)envelope.gain.setValueAtTime(this.gain,releaseStartTime);if(this.releaseShape==="lin"){envelope.gain.linearRampToValueAtTime(0,grainEndTime)}else{envelope.gain.exponentialRampToValueAtTime(this.expRampOffset,grainEndTime)}envelope.connect(this.outputNode);var source=audioContext.createBufferSource();source.buffer=this.buffer;source.playbackRate.value=resamplingRate;source.connect(envelope);source.start(grainTime,grainPosition);source.stop(grainTime+grainDuration/resamplingRate)}}return grainPeriod}}});return GranularEngine}(AudioTimeEngine);module.exports=GranularEngine},{"../core/audio-time-engine":11,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],14:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var AudioTimeEngine=require("../core/audio-time-engine");function optOrDef(opt,def){if(opt!==undefined){return opt}return def}var Metronome=function(_AudioTimeEngine){function Metronome(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,Metronome);_get(_core.Object.getPrototypeOf(Metronome.prototype),"constructor",this).call(this,options.audioContext);this.__period=optOrDef(options.period,1);this.clickFreq=optOrDef(options.clickFreq,600);this.clickAttack=optOrDef(options.clickAttack,.002);this.clickRelease=optOrDef(options.clickRelease,.098);this.__lastTime=0;this.__phase=0;this.__gainNode=this.audioContext.createGain();this.__gainNode.gain.value=optOrDef(options.gain,1);this.outputNode=this.__gainNode}_inherits(Metronome,_AudioTimeEngine);_createClass(Metronome,{advanceTime:{value:function advanceTime(time){this.trigger(time);this.__lastTime=time;return time+this.__period}},syncPosition:{value:function syncPosition(time,position,speed){if(this.__period>0){var nextPosition=(Math.floor(position/this.__period)+this.__phase)*this.__period;if(speed>0&&nextPosition<position)nextPosition+=this.__period;else if(speed<0&&nextPosition>position)nextPosition-=this.__period;return nextPosition}return Infinity}},advancePosition:{value:function advancePosition(time,position,speed){this.trigger(time);if(speed<0){return position-this.__period}return position+this.__period}},trigger:{value:function trigger(time){var audioContext=this.audioContext;var clickAttack=this.clickAttack;var clickRelease=this.clickRelease;var env=audioContext.createGain();env.gain.value=0;env.gain.setValueAtTime(0,time);env.gain.linearRampToValueAtTime(1,time+clickAttack);env.gain.exponentialRampToValueAtTime(1e-7,time+clickAttack+clickRelease);env.gain.setValueAtTime(0,time);env.connect(this.outputNode);var osc=audioContext.createOscillator();osc.frequency.value=this.clickFreq;osc.start(time);osc.stop(time+clickAttack+clickRelease);osc.connect(env)}},gain:{set:function(value){this.__gainNode.gain.value=value},get:function(){return this.__gainNode.gain.value}},period:{set:function(period){this.__period=period;var master=this.master;if(master){if(master.resetEngineTime)master.resetEngineTime(this,this.__lastTime+period);else if(master.resetEnginePosition)master.resetEnginePosition(this)}},get:function(){return this.__period}},phase:{set:function(phase){this.__phase=phase-Math.floor(phase);var master=this.master;if(master&&master.resetEnginePosition!==undefined)master.resetEnginePosition(this)},get:function(){return this.__phase}}});return Metronome}(AudioTimeEngine);module.exports=Metronome},{"../core/audio-time-engine":11,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],15:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var AudioTimeEngine=require("../core/audio-time-engine");function optOrDef(opt,def){if(opt!==undefined){return opt}return def}var PlayerEngine=function(_AudioTimeEngine){function PlayerEngine(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,PlayerEngine);_get(_core.Object.getPrototypeOf(PlayerEngine.prototype),"constructor",this).call(this,options.audioContext);this.transport=null;this.buffer=optOrDef(options.buffer,null);this.fadeTime=optOrDef(options.fadeTime,.005);this.__time=0;this.__position=0;this.__speed=0;this.__bufferSource=null;this.__envNode=null;this.__gainNode=this.audioContext.createGain();this.__gainNode.gain.value=optOrDef(options.gain,1);this.__cyclic=optOrDef(options.cyclic,false);this.outputNode=this.__gainNode}_inherits(PlayerEngine,_AudioTimeEngine);_createClass(PlayerEngine,{__start:{value:function __start(time,position,speed){var audioContext=this.audioContext;if(this.buffer){var bufferDuration=this.buffer.duration;if(this.__cyclic&&(position<0||position>=bufferDuration)){var phase=position/bufferDuration;position=(phase-Math.floor(phase))*bufferDuration}if(position>=0&&position<bufferDuration&&speed>0){this.__envNode=audioContext.createGain();this.__envNode.gain.setValueAtTime(0,time);this.__envNode.gain.linearRampToValueAtTime(1,time+this.fadeTime);this.__envNode.connect(this.__gainNode);this.__bufferSource=audioContext.createBufferSource();this.__bufferSource.buffer=this.buffer;this.__bufferSource.playbackRate.value=speed;this.__bufferSource.loop=this.__cyclic;this.__bufferSource.loopStart=0;this.__bufferSource.loopEnd=bufferDuration;this.__bufferSource.start(time,position);this.__bufferSource.connect(this.__envNode)}}}},__halt:{value:function __halt(time){if(this.__bufferSource){this.__envNode.gain.cancelScheduledValues(time);this.__envNode.gain.setValueAtTime(this.__envNode.gain.value,time);this.__envNode.gain.linearRampToValueAtTime(0,time+this.fadeTime);this.__bufferSource.stop(time+this.fadeTime);this.__bufferSource=null;this.__envNode=null}}},syncSpeed:{value:function syncSpeed(time,position,speed){var seek=arguments[3]===undefined?false:arguments[3];var lastSpeed=this.__speed;if(speed!==lastSpeed||seek){if(seek||lastSpeed*speed<0){this.__halt(time);this.__start(time,position,speed)}else if(lastSpeed===0||seek){this.__start(time,position,speed)}else if(speed===0){this.__halt(time)}else if(this.__bufferSource){this.__bufferSource.playbackRate.setValueAtTime(speed,time)}this.__speed=speed}}},cyclic:{set:function(cyclic){if(cyclic!==this.__cyclic){var time=this.currentTime;var position=this.currentosition;this.__halt(time);this.__cyclic=cyclic;if(this.__speed!==0)this.__start(time,position,this.__speed)}},get:function(){return this.__cyclic}},gain:{set:function(value){var time=this.currentTime;this.__gainNode.cancelScheduledValues(time);this.__gainNode.setValueAtTime(this.__gainNode.gain.value,time);this.__gainNode.linearRampToValueAtTime(0,time+this.fadeTime)},get:function(){return this.__gainNode.gain.value}},bufferDuration:{get:function(){if(this.buffer)return this.buffer.duration;return 0}}});return PlayerEngine}(AudioTimeEngine);module.exports=PlayerEngine},{"../core/audio-time-engine":11,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],16:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var AudioTimeEngine=require("../core/audio-time-engine");function optOrDef(opt,def){if(opt!==undefined){return opt}return def}function getCurrentOrPreviousIndex(sortedArray,value){var index=arguments[2]===undefined?0:arguments[2];var size=sortedArray.length;if(size>0){var firstVal=sortedArray[0];var lastVal=sortedArray[size-1];if(value<firstVal)index=-1;else if(value>=lastVal)index=size-1;else{if(index<0||index>=size)index=Math.floor((size-1)*(value-firstVal)/(lastVal-firstVal));while(sortedArray[index]>value)index--;while(sortedArray[index+1]<=value)index++}}return index}function getCurrentOrNextIndex(sortedArray,value){var index=arguments[2]===undefined?0:arguments[2];var size=sortedArray.length;if(size>0){var firstVal=sortedArray[0];var lastVal=sortedArray[size-1];if(value<=firstVal)index=0;else if(value>=lastVal)index=size;else{if(index<0||index>=size)index=Math.floor((size-1)*(value-firstVal)/(lastVal-firstVal));while(sortedArray[index]<value)index++;while(sortedArray[index+1]>=value)index--}}return index}var SegmentEngine=function(_AudioTimeEngine){function SegmentEngine(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,SegmentEngine);_get(_core.Object.getPrototypeOf(SegmentEngine.prototype),"constructor",this).call(this,options.audioContext);this.buffer=optOrDef(options.buffer,null);this.periodAbs=optOrDef(options.periodAbs,0);this.periodRel=optOrDef(options.periodRel,1);this.periodVar=optOrDef(options.periodVar,0);this.positionArray=optOrDef(options.positionArray,[0]);this.positionVar=optOrDef(options.positionVar,0);this.durationArray=optOrDef(options.durationArray,[0]);this.durationAbs=optOrDef(options.durationAbs,0);this.durationRel=optOrDef(options.durationRel,1);this.offsetArray=optOrDef(options.offsetArray,[0]);this.offsetAbs=optOrDef(options.offsetAbs,-.005);this.offsetRel=optOrDef(options.offsetRel,0);this.delay=optOrDef(options.delay,.005);this.attackAbs=optOrDef(options.attackAbs,.005);this.attackRel=optOrDef(options.attackRel,0);this.releaseAbs=optOrDef(options.releaseAbs,.005);this.releaseRel=optOrDef(options.releaseRel,0);this.resampling=optOrDef(options.resampling,0);this.resamplingVar=optOrDef(options.resamplingVar,0);
this.gain=optOrDef(options.gain,1);this.segmentIndex=optOrDef(options.segmentIndex,0);this.cyclic=optOrDef(options.cyclic,false);this.__cyclicOffset=0;this.wrapAroundExtension=optOrDef(options.wrapAroundExtension,0);this.outputNode=this.audioContext.createGain()}_inherits(SegmentEngine,_AudioTimeEngine);_createClass(SegmentEngine,{bufferDuration:{get:function(){if(this.buffer){var bufferDuration=this.buffer.duration;if(this.wrapAroundExtension)bufferDuration-=this.wrapAroundExtension;return bufferDuration}return 0}},advanceTime:{value:function advanceTime(time){time=Math.max(time,this.audioContext.currentTime);return time+this.trigger(time)}},syncPosition:{value:function syncPosition(time,position,speed){var index=this.segmentIndex;var cyclicOffset=0;var bufferDuration=this.bufferDuration;if(this.cyclic){var cycles=position/bufferDuration;cyclicOffset=Math.floor(cycles)*bufferDuration;position-=cyclicOffset}if(speed>0){index=getCurrentOrNextIndex(this.positionArray,position);if(index>=this.positionArray.length){index=0;cyclicOffset+=bufferDuration;if(!this.cyclic){return Infinity}}}else if(speed<0){index=getCurrentOrPreviousIndex(this.positionArray,position);if(index<0){index=this.positionArray.length-1;cyclicOffset-=bufferDuration;if(!this.cyclic){return-Infinity}}}else{return Infinity}this.segmentIndex=index;this.__cyclicOffset=cyclicOffset;return cyclicOffset+this.positionArray[index]}},advancePosition:{value:function advancePosition(time,position,speed){var index=this.segmentIndex;var cyclicOffset=this.__cyclicOffset;this.trigger(time);if(speed>0){index++;if(index>=this.positionArray.length){index=0;cyclicOffset+=this.bufferDuration;if(!this.cyclic){return Infinity}}}else{index--;if(index<0){index=this.positionArray.length-1;cyclicOffset-=this.bufferDuration;if(!this.cyclic){return-Infinity}}}this.segmentIndex=index;this.__cyclicOffset=cyclicOffset;return cyclicOffset+this.positionArray[index]}},trigger:{value:function trigger(time){var audioContext=this.audioContext;var segmentTime=(time||audioContext.currentTime)+this.delay;var segmentPeriod=this.periodAbs;var segmentIndex=this.segmentIndex;if(this.buffer){var segmentPosition=0;var segmentDuration=0;var segmentOffset=0;var resamplingRate=1;var bufferDuration=this.bufferDuration;if(this.cyclic)segmentIndex=segmentIndex%this.positionArray.length;else segmentIndex=Math.max(0,Math.min(segmentIndex,this.positionArray.length-1));if(this.positionArray)segmentPosition=this.positionArray[segmentIndex]||0;if(this.durationArray)segmentDuration=this.durationArray[segmentIndex]||0;if(this.offsetArray)segmentOffset=this.offsetArray[segmentIndex]||0;if(this.resampling!==0||this.resamplingVar>0){var randomResampling=(Math.random()-.5)*2*this.resamplingVar;resamplingRate=Math.pow(2,(this.resampling+randomResampling)/1200)}if(segmentDuration===0||this.periodRel>0){var nextSegementIndex=segmentIndex+1;var nextPosition,nextOffset;if(nextSegementIndex===this.positionArray.length){if(this.cyclic){nextPosition=this.positionArray[0]+bufferDuration;nextOffset=this.offsetArray[0]}else{nextPosition=bufferDuration;nextOffset=0}}else{nextPosition=this.positionArray[nextSegementIndex];nextOffset=this.offsetArray[nextSegementIndex]}var interSegmentDistance=nextPosition-segmentPosition;if(segmentOffset>0)interSegmentDistance-=segmentOffset;if(nextOffset>0)interSegmentDistance+=nextOffset;if(interSegmentDistance<0)interSegmentDistance=0;if(segmentDuration===0)segmentDuration=interSegmentDistance;segmentPeriod+=this.periodRel*interSegmentDistance}segmentDuration*=this.durationRel;segmentDuration+=this.durationAbs;segmentOffset*=this.offsetRel;segmentOffset+=this.offsetAbs;if(segmentOffset<0){segmentDuration-=segmentOffset;segmentPosition+=segmentOffset;segmentTime+=segmentOffset/resamplingRate}else{segmentTime-=segmentOffset/resamplingRate}if(this.positionVar>0)segmentPosition+=2*(Math.random()-.5)*this.positionVar;if(segmentPosition<0){segmentDuration+=segmentPosition;segmentPosition=0}if(segmentPosition+segmentDuration>this.buffer.duration)segmentDuration=this.buffer.duration-segmentPosition;if(this.gain>0&&segmentDuration>0){var envelope=audioContext.createGain();var attack=this.attackAbs+this.attackRel*segmentDuration;var release=this.releaseAbs+this.releaseRel*segmentDuration;if(attack+release>segmentDuration){var factor=segmentDuration/(attack+release);attack*=factor;release*=factor}var attackEndTime=segmentTime+attack;var segmentEndTime=segmentTime+segmentDuration;var releaseStartTime=segmentEndTime-release;envelope.gain.setValueAtTime(0,segmentTime);envelope.gain.linearRampToValueAtTime(this.gain,attackEndTime);if(releaseStartTime>attackEndTime)envelope.gain.setValueAtTime(this.gain,releaseStartTime);envelope.gain.linearRampToValueAtTime(0,segmentEndTime);envelope.connect(this.outputNode);var source=audioContext.createBufferSource();source.buffer=this.buffer;source.playbackRate.value=resamplingRate;source.connect(envelope);source.start(segmentTime,segmentPosition);source.stop(segmentTime+segmentDuration/resamplingRate)}}return segmentPeriod}}});return SegmentEngine}(AudioTimeEngine);module.exports=SegmentEngine},{"../core/audio-time-engine":11,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],17:[function(require,module,exports){"use strict";var _core=require("babel-runtime/core-js")["default"];var defaultAudioContext=require("../core/audio-context");var Scheduler=require("./scheduler");var SimpleScheduler=require("./simple-scheduler");var schedulerMap=new _core.WeakMap;var simpleSchedulerMap=new _core.WeakMap;module.exports.getScheduler=function(){var audioContext=arguments[0]===undefined?defaultAudioContext:arguments[0];var scheduler=schedulerMap.get(audioContext);if(!scheduler){scheduler=new Scheduler({audioContext:audioContext});schedulerMap.set(audioContext,scheduler)}return scheduler};module.exports.getSimpleScheduler=function(){var audioContext=arguments[0]===undefined?defaultAudioContext:arguments[0];var simpleScheduler=simpleSchedulerMap.get(audioContext);if(!simpleScheduler){simpleScheduler=new SimpleScheduler({audioContext:audioContext});simpleSchedulerMap.set(audioContext,simpleScheduler)}return simpleScheduler}},{"../core/audio-context":10,"./scheduler":19,"./simple-scheduler":20,"babel-runtime/core-js":24}],18:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var defaultAudioContext=require("../core/audio-context");var TimeEngine=require("../core/time-engine");var SchedulingQueue=require("../utils/scheduling-queue");var getScheduler=require("./factories").getScheduler;var LoopControl=function(_TimeEngine){function LoopControl(playControl){_classCallCheck(this,LoopControl);_get(_core.Object.getPrototypeOf(LoopControl.prototype),"constructor",this).call(this);this.__playControl=playControl;this.lower=-Infinity;this.upper=Infinity}_inherits(LoopControl,_TimeEngine);_createClass(LoopControl,{advanceTime:{value:function advanceTime(time){var playControl=this.__playControl;var speed=playControl.speed;var lower=this.lower;var upper=this.upper;if(speed>0){playControl.syncSpeed(time,lower,speed,true);return playControl.__getTimeAtPosition(upper)}else if(speed<0){playControl.syncSpeed(time,upper,speed,true);return playControl.__getTimeAtPosition(lower)}return Infinity}},reschedule:{value:function reschedule(speed){var playControl=this.__playControl;var lower=Math.min(playControl.__loopStart,playControl.__loopEnd);var upper=Math.max(playControl.__loopStart,playControl.__loopEnd);this.speed=speed;this.lower=lower;this.upper=upper;if(lower===upper)speed=0;if(speed>0)this.resetTime(playControl.__getTimeAtPosition(upper-1e-6));else if(speed<0)this.resetTime(playControl.__getTimeAtPosition(lower+1e-6));else this.resetTime(Infinity)}},applyLoopBoundaries:{value:function applyLoopBoundaries(position,speed){var lower=this.lower;var upper=this.upper;if(speed>0&&position>=upper){return lower+(position-lower)%(upper-lower)}else if(speed<0&&position<lower){return upper-(upper-position)%(upper-lower)}return position}}});return LoopControl}(TimeEngine);var PlayControlled=function(){function PlayControlled(playControl,engine){_classCallCheck(this,PlayControlled);this.__playControl=playControl;this.__engine=engine;engine.master=this}_createClass(PlayControlled,{syncSpeed:{value:function syncSpeed(time,position,speed,seek,lastSpeed){this.__engine.syncSpeed(time,position,speed,seek)}},currentTime:{get:function(){return this.__playControl.currentTime}},currentPosition:{get:function(){return this.__playControl.currentPosition}},destroy:{value:function destroy(){this.__engine.master=null;this.__playControl=null;this.__engine=null}}});return PlayControlled}();var PlayControlledSpeedControlled=function(_PlayControlled){function PlayControlledSpeedControlled(playControl,engine){_classCallCheck(this,PlayControlledSpeedControlled);_get(_core.Object.getPrototypeOf(PlayControlledSpeedControlled.prototype),"constructor",this).call(this,playControl,engine)}_inherits(PlayControlledSpeedControlled,_PlayControlled);return PlayControlledSpeedControlled}(PlayControlled);var TransportedSchedulerHook=function(_TimeEngine2){function TransportedSchedulerHook(playControl,engine){_classCallCheck(this,TransportedSchedulerHook);_get(_core.Object.getPrototypeOf(TransportedSchedulerHook.prototype),"constructor",this).call(this);this.__playControl=playControl;this.__engine=engine;this.__nextPosition=Infinity;playControl.__scheduler.add(this,Infinity)}_inherits(TransportedSchedulerHook,_TimeEngine2);_createClass(TransportedSchedulerHook,{advanceTime:{value:function advanceTime(time){var playControl=this.__playControl;var engine=this.__engine;var position=this.__nextPosition;var nextPosition=engine.advancePosition(time,position,playControl.__speed);var nextTime=playControl.__getTimeAtPosition(nextPosition);while(nextTime<=time){nextPosition=engine.advancePosition(time,position,playControl.__speed);nextTime=playControl.__getTimeAtPosition(nextPosition)}this.__nextPosition=nextPosition;return nextTime}},resetPosition:{value:function resetPosition(){var position=arguments[0]===undefined?this.__nextPosition:arguments[0];var time=this.__playControl.__getTimeAtPosition(position);this.__nextPosition=position;this.resetTime(time)}},destroy:{value:function destroy(){this.__playControl.__scheduler.remove(this);this.__playControl=null;this.__engine=null}}});return TransportedSchedulerHook}(TimeEngine);var PlayControlledTransported=function(_PlayControlled2){function PlayControlledTransported(playControl,engine){_classCallCheck(this,PlayControlledTransported);_get(_core.Object.getPrototypeOf(PlayControlledTransported.prototype),"constructor",this).call(this,playControl,engine);this.__schedulerHook=new TransportedSchedulerHook(playControl,engine)}_inherits(PlayControlledTransported,_PlayControlled2);_createClass(PlayControlledTransported,{syncSpeed:{value:function syncSpeed(time,position,speed,seek,lastSpeed){var nextPosition=this.__nextPosition;if(seek){nextPosition=this.__engine.syncPosition(time,position,speed)}else if(lastSpeed===0){nextPosition=this.__engine.syncPosition(time,position,speed)}else if(speed===0){nextPosition=Infinity;if(this.__engine.syncSpeed)this.__engine.syncSpeed(time,position,0)}else if(speed*lastSpeed<0){nextPosition=this.__engine.syncPosition(time,position,speed)}else if(this.__engine.syncSpeed){this.__engine.syncSpeed(time,position,speed)}this.__schedulerHook.resetPosition(nextPosition)}},resetEnginePosition:{value:function resetEnginePosition(engine){var position=arguments[1]===undefined?undefined:arguments[1];if(position===undefined){var playControl=this.__playControl;var time=playControl.__sync();position=this.__engine.syncPosition(time,playControl.__position,playControl.__speed)}this.__schedulerHook.resetPosition(position)}},destroy:{value:function destroy(){this.__schedulerHook.destroy();this.__schedulerHook=null;_get(_core.Object.getPrototypeOf(PlayControlledTransported.prototype),"destroy",this).call(this)}}});return PlayControlledTransported}(PlayControlled);var ScheduledSchedulingQueue=function(_SchedulingQueue){function ScheduledSchedulingQueue(playControl,engine){_classCallCheck(this,ScheduledSchedulingQueue);_get(_core.Object.getPrototypeOf(ScheduledSchedulingQueue.prototype),"constructor",this).call(this);this.__playControl=playControl;this.__engine=engine;this.add(engine,Infinity);playControl.__scheduler.add(this,Infinity)}_inherits(ScheduledSchedulingQueue,_SchedulingQueue);_createClass(ScheduledSchedulingQueue,{currentTime:{get:function(){return this.__playControl.currentTime}},currentPosition:{get:function(){return this.__playControl.currentPosition}},destroy:{value:function destroy(){this.__playControl.__scheduler.remove(this);this.remove(this.__engine);this.__playControl=null;this.__engine=null}}});return ScheduledSchedulingQueue}(SchedulingQueue);var PlayControlledScheduled=function(_PlayControlled3){function PlayControlledScheduled(playControl,engine){_classCallCheck(this,PlayControlledScheduled);_get(_core.Object.getPrototypeOf(PlayControlledScheduled.prototype),"constructor",this).call(this,playControl,engine);this.__schedulingQueue=new ScheduledSchedulingQueue(playControl,engine)}_inherits(PlayControlledScheduled,_PlayControlled3);_createClass(PlayControlledScheduled,{syncSpeed:{value:function syncSpeed(time,position,speed,seek,lastSpeed){if(lastSpeed===0&&speed!==0)this.__engine.resetTime();else if(lastSpeed!==0&&speed===0)this.__engine.resetTime(Infinity)}},destroy:{value:function destroy(){this.__schedulingQueue.destroy();_get(_core.Object.getPrototypeOf(PlayControlledScheduled.prototype),"destroy",this).call(this)}}});return PlayControlledScheduled}(PlayControlled);var PlayControl=function(_TimeEngine3){function PlayControl(engine){var options=arguments[1]===undefined?{}:arguments[1];_classCallCheck(this,PlayControl);_get(_core.Object.getPrototypeOf(PlayControl.prototype),"constructor",this).call(this);this.audioContext=options.audioContext||defaultAudioContext;this.__scheduler=getScheduler(this.audioContext);this.__playControlled=null;this.__loopControl=null;this.__loopStart=0;this.__loopEnd=Infinity;this.__time=0;this.__position=0;this.__speed=0;this.__playingSpeed=1;if(engine)this.__setEngine(engine)}_inherits(PlayControl,_TimeEngine3);_createClass(PlayControl,{__setEngine:{value:function __setEngine(engine){if(engine.master)throw new Error("object has already been added to a master");if(engine.implementsSpeedControlled())this.__playControlled=new PlayControlledSpeedControlled(this,engine);else if(engine.implementsTransported())this.__playControlled=new PlayControlledTransported(this,engine);else if(engine.implementsScheduled())this.__playControlled=new PlayControlledScheduled(this,engine);else throw new Error("object cannot be added to play control")}},__resetEngine:{value:function __resetEngine(){this.__playControlled.destroy();this.__playControlled=null}},__getTimeAtPosition:{value:function __getTimeAtPosition(position){return this.__time+(position-this.__position)/this.__speed}},__getPositionAtTime:{value:function __getPositionAtTime(time){return this.__position+(time-this.__time)*this.__speed}},__sync:{value:function __sync(){var now=this.currentTime;this.__position+=(now-this.__time)*this.__speed;this.__time=now;return now}},currentTime:{get:function(){return this.__scheduler.currentTime}},currentPosition:{get:function(){return this.__position+(this.__scheduler.currentTime-this.__time)*this.__speed}},set:{value:function set(){var engine=arguments[0]===undefined?null:arguments[0];var time=this.__sync();var speed=this.__speed;if(this.__playControlled!==null&&this.__playControlled.__engine!==engine){this.syncSpeed(time,this.__position,0);if(this.__playControlled)this.__resetEngine();if(this.__playControlled===null&&engine!==null){this.__setEngine(engine);if(speed!==0)this.syncSpeed(time,this.__position,speed)}}}},loop:{set:function(enable){if(enable&&this.__loopStart>-Infinity&&this.__loopEnd<Infinity){if(!this.__loopControl){this.__loopControl=new LoopControl(this);this.__scheduler.add(this.__loopControl,Infinity)}if(this.__speed!==0)this.__loopControl.reschedule(this.__speed)}else if(this.__loopControl){this.__scheduler.remove(this.__loopControl);this.__loopControl=null}},get:function(){return!!this.__loopControl}},setLoopBoundaries:{value:function setLoopBoundaries(loopStart,loopEnd){this.__loopStart=loopStart;this.__loopEnd=loopEnd;this.loop=this.loop}},loopStart:{set:function(loopStart){this.setLoopBoundaries(loopStart,this.__loopEnd)},get:function(){return this.__loopStart}},loopEnd:{set:function(loopEnd){this.setLoopBoundaries(this.__loopStart,loopEnd)},get:function(){return this.__loopEnd}},syncSpeed:{value:function syncSpeed(time,position,speed){var seek=arguments[3]===undefined?false:arguments[3];var lastSpeed=this.__speed;if(speed!==lastSpeed||seek){if((seek||lastSpeed===0)&&this.__loopControl)position=this.__loopControl.applyLoopBoundaries(position,speed);this.__time=time;this.__position=position;this.__speed=speed;if(this.__playControlled)this.__playControlled.syncSpeed(time,position,speed,seek,lastSpeed);if(this.__loopControl)this.__loopControl.reschedule(speed)}}},start:{value:function start(){var time=this.__sync();this.syncSpeed(time,this.__position,this.__playingSpeed)}},pause:{value:function pause(){var time=this.__sync();this.syncSpeed(time,this.__position,0)}},stop:{value:function stop(){var time=this.__sync();this.syncSpeed(time,this.__position,0);this.seek(0)}},speed:{set:function(speed){var time=this.__sync();if(speed>=0){if(speed<.01)speed=.01;else if(speed>100)speed=100}else{if(speed<-100)speed=-100;else if(speed>-.01)speed=-.01}this.__playingSpeed=speed;if(this.__speed!==0)this.syncSpeed(time,this.__position,speed)},get:function(){return this.__playingSpeed}},seek:{value:function seek(position){if(position!==this.__position){var time=this.__sync();this.__position=position;this.syncSpeed(time,position,this.__speed,true)}}}});return PlayControl}(TimeEngine);module.exports=PlayControl},{"../core/audio-context":10,"../core/time-engine":12,"../utils/scheduling-queue":23,"./factories":17,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],19:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var defaultAudioContext=require("../core/audio-context");var TimeEngine=require("../core/time-engine");var PriorityQueue=require("../utils/priority-queue");var SchedulingQueue=require("../utils/scheduling-queue");var Scheduler=function(_SchedulingQueue){function Scheduler(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,Scheduler);_get(_core.Object.getPrototypeOf(Scheduler.prototype),"constructor",this).call(this);this.audioContext=options.audioContext||defaultAudioContext;this.__currentTime=null;this.__nextTime=Infinity;this.__timeout=null;this.period=options.period||.025;this.lookahead=options.lookahead||.1}_inherits(Scheduler,_SchedulingQueue);_createClass(Scheduler,{__tick:{value:function __tick(){var audioContext=this.audioContext;var time=this.__nextTime;this.__timeout=null;while(time<=audioContext.currentTime+this.lookahead){this.__currentTime=time;time=this.advanceTime(time)}this.__currentTime=null;this.resetTime(time)}},resetTime:{value:function resetTime(){var _this=this;var time=arguments[0]===undefined?this.currentTime:arguments[0];if(this.master){this.master.reset(this,time)}else{if(this.__timeout){clearTimeout(this.__timeout);this.__timeout=null}if(time!==Infinity){if(this.__nextTime===Infinity)console.log("Scheduler Start");var timeOutDelay=Math.max(time-this.lookahead-this.audioContext.currentTime,this.period);this.__timeout=setTimeout(function(){_this.__tick()},timeOutDelay*1e3)}else if(this.__nextTime!==Infinity){console.log("Scheduler Stop")}this.__nextTime=time}}},currentTime:{get:function(){if(this.master)return this.master.currentTime;return this.__currentTime||this.audioContext.currentTime+this.lookahead}},currentPosition:{get:function(){var master=this.master;if(master&&master.currentPosition!==undefined)return master.currentPosition;return undefined}},add:{value:function add(engineOrFunction){var time=arguments[1]===undefined?this.currentTime:arguments[1];var engine;if(engineOrFunction instanceof Function){engine={advanceTime:engineOrFunction}}else{engine=engineOrFunction;if(!engine.implementsScheduled())throw new Error("object cannot be added to scheduler");if(engine.master)throw new Error("object has already been added to a master")}_get(_core.Object.getPrototypeOf(Scheduler.prototype),"add",this).call(this,engine,time)}},remove:{value:function remove(engine){if(engine.master!==this)throw new Error("object has not been added to this scheduler");_get(_core.Object.getPrototypeOf(Scheduler.prototype),"remove",this).call(this,engine)}},resetEngineTime:{value:function resetEngineTime(engine){var time=arguments[1]===undefined?this.currentTime:arguments[1];if(engine.master!==this)throw new Error("object has not been added to this scheduler");_get(_core.Object.getPrototypeOf(Scheduler.prototype),"resetEngineTime",this).call(this,engine,time)}}});return Scheduler}(SchedulingQueue);module.exports=Scheduler},{"../core/audio-context":10,"../core/time-engine":12,"../utils/priority-queue":22,"../utils/scheduling-queue":23,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],20:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var defaultAudioContext=require("../core/audio-context");var TimeEngine=require("../core/time-engine");function arrayRemove(array,value){var index=array.indexOf(value);if(index>=0){array.splice(index,1);return true}return false}var SimpleScheduler=function(){function SimpleScheduler(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,SimpleScheduler);this.audioContext=options.audioContext||defaultAudioContext;this.__engines=[];this.__schedEngines=[];this.__schedTimes=[];this.__currentTime=null;this.__timeout=null;this.period=options.period||.025;this.lookahead=options.lookahead||.1}_createClass(SimpleScheduler,{__scheduleEngine:{value:function __scheduleEngine(engine,time){this.__schedEngines.push(engine);this.__schedTimes.push(time)}},__rescheduleEngine:{value:function __rescheduleEngine(engine,time){var index=this.__schedEngines.indexOf(engine);if(index>=0){if(time!==Infinity){this.__schedTimes[index]=time}else{this.__schedEngines.splice(index,1);this.__schedTimes.splice(index,1)}}else if(time<Infinity){this.__schedEngines.push(engine);this.__schedTimes.push(time)}}},__unscheduleEngine:{value:function __unscheduleEngine(engine){var index=this.__schedEngines.indexOf(engine);if(index>=0){this.__schedEngines.splice(index,1);this.__schedTimes.splice(index,1)}}},__resetTick:{value:function __resetTick(){if(this.__schedEngines.length>0){if(!this.__timeout){console.log("SimpleScheduler Start");this.__tick()}}else if(this.__timeout){console.log("SimpleScheduler Stop");clearTimeout(this.__timeout);this.__timeout=null}}},__tick:{value:function __tick(){var _this=this;var audioContext=this.audioContext;var i=0;while(i<this.__schedEngines.length){var engine=this.__schedEngines[i];var time=this.__schedTimes[i];while(time&&time<=audioContext.currentTime+this.lookahead){time=Math.max(time,audioContext.currentTime);this.__currentTime=time;time=engine.advanceTime(time)}if(time&&time<Infinity){this.__schedTimes[i++]=time}else{this.__unscheduleEngine(engine);if(!time){engine.master=null;arrayRemove(this.__engines,engine)}}}this.__currentTime=null;this.__timeout=null;if(this.__schedEngines.length>0){this.__timeout=setTimeout(function(){_this.__tick()},this.period*1e3)}}},currentTime:{get:function(){return this.__currentTime||this.audioContext.currentTime+this.lookahead}},currentPosition:{get:function(){return undefined}},add:{value:function add(engineOrFunction){var time=arguments[1]===undefined?this.currentTime:arguments[1];var getCurrentPosition=arguments[2]===undefined?null:arguments[2];var engine=engineOrFunction;if(engineOrFunction instanceof Function)engine={advanceTime:engineOrFunction};else if(!engineOrFunction.implementsScheduled())throw new Error("object cannot be added to scheduler");else if(engineOrFunction.master)throw new Error("object has already been added to a master");engine.master=this;this.__engines.push(engine);this.__scheduleEngine(engine,time);this.__resetTick();return engine}},remove:{value:function remove(engine){if(!engine.master||engine.master!==this)throw new Error("engine has not been added to this scheduler");engine.master=null;arrayRemove(this.__engines,engine);this.__unscheduleEngine(engine);this.__resetTick()}},resetEngineTime:{value:function resetEngineTime(engine){var time=arguments[1]===undefined?this.currentTime:arguments[1];this.__rescheduleEngine(engine,time);this.__resetTick()}},clear:{value:function clear(){if(this.__timeout){clearTimeout(this.__timeout);this.__timeout=null}this.__schedEngines.length=0;this.__schedTimes.length=0}}});return SimpleScheduler}();module.exports=SimpleScheduler},{"../core/audio-context":10,"../core/time-engine":12,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26}],21:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _core=require("babel-runtime/core-js")["default"];var defaultAudioContext=require("../core/audio-context");var TimeEngine=require("../core/time-engine");var PriorityQueue=require("../utils/priority-queue");var SchedulingQueue=require("../utils/scheduling-queue");var getScheduler=require("./factories").getScheduler;function addDuplet(firstArray,secondArray,firstElement,secondElement){firstArray.push(firstElement);secondArray.push(secondElement)}function removeDuplet(firstArray,secondArray,firstElement){var index=firstArray.indexOf(firstElement);if(index>=0){var secondElement=secondArray[index];firstArray.splice(index,1);secondArray.splice(index,1);return secondElement}return null}var Transported=function(_TimeEngine){function Transported(transport,engine,startPosition,endPosition,offsetPosition){_classCallCheck(this,Transported);this.master=transport;engine.master=this;this.__engine=engine;this.__startPosition=startPosition;this.__endPosition=endPosition;this.__offsetPosition=offsetPosition;this.__scalePosition=1;this.__haltPosition=Infinity}_inherits(Transported,_TimeEngine);_createClass(Transported,{setBoundaries:{value:function setBoundaries(startPosition,endPosition){var _this=this;var offsetPosition=arguments[2]===undefined?startPosition:arguments[2];var scalePosition=arguments[3]===undefined?1:arguments[3];return function(){_this.__startPosition=startPosition;_this.__endPosition=endPosition;_this.__offsetPosition=offsetPosition;_this.__scalePosition=scalePosition;_this.resetPosition()}()}},start:{value:function start(time,position,speed){}},stop:{value:function stop(time,position){}},currentTime:{get:function(){return this.master.currentTime}},currentPosition:{get:function(){return this.master.currentPosition-this.__offsetPosition}},resetPosition:{value:function resetPosition(position){if(position!==undefined)position+=this.__offsetPosition;this.master.resetEnginePosition(this,position)}},syncPosition:{value:function syncPosition(time,position,speed){if(speed>0){if(position<this.__startPosition){if(this.__haltPosition===null)this.stop(time,position-this.__offsetPosition);this.__haltPosition=this.__endPosition;return this.__startPosition}else if(position<=this.__endPosition){this.start(time,position-this.__offsetPosition,speed);this.__haltPosition=null;return this.__endPosition}}else{if(position>=this.__endPosition){if(this.__haltPosition===null)this.stop(time,position-this.__offsetPosition);this.__haltPosition=this.__startPosition;return this.__endPosition}else if(position>this.__startPosition){this.start(time,position-this.__offsetPosition,speed);this.__haltPosition=null;return this.__startPosition}}if(this.__haltPosition===null)this.stop(time,position);this.__haltPosition=Infinity;return Infinity}},advancePosition:{value:function advancePosition(time,position,speed){var haltPosition=this.__haltPosition;if(haltPosition!==null){this.start(time,position-this.__offsetPosition,speed);this.__haltPosition=null;return haltPosition}if(this.__haltPosition===null)this.stop(time,position-this.__offsetPosition);this.__haltPosition=Infinity;return Infinity}},syncSpeed:{value:function syncSpeed(time,position,speed){if(speed===0)this.stop(time,position-this.__offsetPosition)}},destroy:{value:function destroy(){this.master=null;this.__engine.master=null;this.__engine=null}}});return Transported}(TimeEngine);var TransportedTransported=function(_Transported){function TransportedTransported(transport,engine,startPosition,endPosition,offsetPosition){_classCallCheck(this,TransportedTransported);_get(_core.Object.getPrototypeOf(TransportedTransported.prototype),"constructor",this).call(this,transport,engine,startPosition,endPosition,offsetPosition)}_inherits(TransportedTransported,_Transported);_createClass(TransportedTransported,{syncPosition:{value:function syncPosition(time,position,speed){if(speed>0&&position<this.__endPosition)position=Math.max(position,this.__startPosition);else if(speed<0&&position>=this.__startPosition)position=Math.min(position,this.__endPosition);return this.__offsetPosition+this.__engine.syncPosition(time,position-this.__offsetPosition,speed)}},advancePosition:{value:function advancePosition(time,position,speed){position=this.__offsetPosition+this.__engine.advancePosition(time,position-this.__offsetPosition,speed);if(speed>0&&position<this.__endPosition||speed<0&&position>=this.__startPosition){return position}return Infinity}},syncSpeed:{value:function syncSpeed(time,position,speed){if(this.__engine.syncSpeed)this.__engine.syncSpeed(time,position,speed)}},resetEnginePosition:{value:function resetEnginePosition(engine){var position=arguments[1]===undefined?undefined:arguments[1];if(position!==undefined)position+=this.__offsetPosition;this.resetPosition(position)}}});return TransportedTransported}(Transported);var TransportedSpeedControlled=function(_Transported2){function TransportedSpeedControlled(transport,engine,startPosition,endPosition,offsetPosition){_classCallCheck(this,TransportedSpeedControlled);_get(_core.Object.getPrototypeOf(TransportedSpeedControlled.prototype),"constructor",this).call(this,transport,engine,startPosition,endPosition,offsetPosition)}_inherits(TransportedSpeedControlled,_Transported2);_createClass(TransportedSpeedControlled,{start:{value:function start(time,position,speed){this.__engine.syncSpeed(time,position,speed,true)}},stop:{value:function stop(time,position){this.__engine.syncSpeed(time,position,0);
}},syncSpeed:{value:function syncSpeed(time,position,speed){if(this.__haltPosition===null)this.__engine.syncSpeed(time,position,speed)}},destroy:{value:function destroy(){this.__engine.syncSpeed(this.master.currentTime,this.master.currentPosition-this.__offsetPosition,0);_get(_core.Object.getPrototypeOf(TransportedSpeedControlled.prototype),"destroy",this).call(this)}}});return TransportedSpeedControlled}(Transported);var TransportedScheduled=function(_Transported3){function TransportedScheduled(transport,engine,startPosition,endPosition,offsetPosition){_classCallCheck(this,TransportedScheduled);_get(_core.Object.getPrototypeOf(TransportedScheduled.prototype),"constructor",this).call(this,transport,engine,startPosition,endPosition,offsetPosition);transport.__schedulingQueue.add(engine,Infinity)}_inherits(TransportedScheduled,_Transported3);_createClass(TransportedScheduled,{start:{value:function start(time,position,speed){this.master.__schedulingQueue.resetEngineTime(this.__engine,time)}},stop:{value:function stop(time,position){this.master.__schedulingQueue.resetEngineTime(this.__engine,Infinity)}},destroy:{value:function destroy(){this.master.__schedulingQueue.remove(this.__engine);_get(_core.Object.getPrototypeOf(TransportedScheduled.prototype),"destroy",this).call(this)}}});return TransportedScheduled}(Transported);var TransportSchedulerHook=function(_TimeEngine2){function TransportSchedulerHook(transport){_classCallCheck(this,TransportSchedulerHook);_get(_core.Object.getPrototypeOf(TransportSchedulerHook.prototype),"constructor",this).call(this);this.__transport=transport;this.__nextPosition=Infinity;this.__nextTime=Infinity;transport.__scheduler.add(this,Infinity)}_inherits(TransportSchedulerHook,_TimeEngine2);_createClass(TransportSchedulerHook,{advanceTime:{value:function advanceTime(time){var transport=this.__transport;var position=this.__nextPosition;var speed=transport.__speed;var nextPosition=transport.advancePosition(time,position,speed);var nextTime=transport.__getTimeAtPosition(nextPosition);while(nextTime<=time){nextPosition=transport.advancePosition(nextTime,nextPosition,speed);nextTime=transport.__getTimeAtPosition(nextPosition)}this.__nextPosition=nextPosition;this.__nextTime=nextTime;return nextTime}},resetPosition:{value:function resetPosition(){var position=arguments[0]===undefined?this.__nextPosition:arguments[0];var transport=this.__transport;var time=transport.__getTimeAtPosition(position);this.__nextPosition=position;this.__nextTime=time;this.resetTime(time)}},destroy:{value:function destroy(){this.__transport.__scheduler.remove(this);this.__transport=null}}});return TransportSchedulerHook}(TimeEngine);var TransportSchedulingQueue=function(_SchedulingQueue){function TransportSchedulingQueue(transport){_classCallCheck(this,TransportSchedulingQueue);_get(_core.Object.getPrototypeOf(TransportSchedulingQueue.prototype),"constructor",this).call(this);this.__transport=transport;transport.__scheduler.add(this,Infinity)}_inherits(TransportSchedulingQueue,_SchedulingQueue);_createClass(TransportSchedulingQueue,{currentTime:{get:function(){return this.__transport.currentTime}},currentPosition:{get:function(){return this.__transport.currentPosition}},destroy:{value:function destroy(){this.__transport.__scheduler.remove(this);this.__transport=null}}});return TransportSchedulingQueue}(SchedulingQueue);var Transport=function(_TimeEngine3){function Transport(){var options=arguments[0]===undefined?{}:arguments[0];_classCallCheck(this,Transport);_get(_core.Object.getPrototypeOf(Transport.prototype),"constructor",this).call(this);this.audioContext=options.audioContext||defaultAudioContext;this.__engines=[];this.__transported=[];this.__scheduler=getScheduler(this.audioContext);this.__schedulerHook=new TransportSchedulerHook(this);this.__transportedQueue=new PriorityQueue;this.__schedulingQueue=new TransportSchedulingQueue(this);this.__time=0;this.__position=0;this.__speed=0}_inherits(Transport,_TimeEngine3);_createClass(Transport,{__getTimeAtPosition:{value:function __getTimeAtPosition(position){return this.__time+(position-this.__position)/this.__speed}},__getPositionAtTime:{value:function __getPositionAtTime(time){return this.__position+(time-this.__time)*this.__speed}},__syncTransportedPosition:{value:function __syncTransportedPosition(time,position,speed){var numTransportedEngines=this.__transported.length;var nextPosition=Infinity;if(numTransportedEngines>0){var engine,nextEnginePosition;this.__transportedQueue.clear();this.__transportedQueue.reverse=speed<0;for(var i=numTransportedEngines-1;i>0;i--){engine=this.__transported[i];nextEnginePosition=engine.syncPosition(time,position,speed);this.__transportedQueue.insert(engine,nextEnginePosition,false)}engine=this.__transported[0];nextEnginePosition=engine.syncPosition(time,position,speed);nextPosition=this.__transportedQueue.insert(engine,nextEnginePosition,true)}return nextPosition}},__syncTransportedSpeed:{value:function __syncTransportedSpeed(time,position,speed){var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_core.$for.getIterator(this.__transported),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var transported=_step.value;transported.syncSpeed(time,position,speed)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}},currentTime:{get:function(){return this.__scheduler.currentTime}},currentPosition:{get:function(){var master=this.master;if(master&&master.currentPosition!==undefined)return master.currentPosition;return this.__position+(this.__scheduler.currentTime-this.__time)*this.__speed}},resetPosition:{value:function resetPosition(position){var master=this.master;if(master&&master.resetEnginePosition!==undefined)master.resetEnginePosition(this,position);else this.__schedulerHook.resetPosition(position)}},syncPosition:{value:function syncPosition(time,position,speed){this.__time=time;this.__position=position;this.__speed=speed;return this.__syncTransportedPosition(time,position,speed)}},advancePosition:{value:function advancePosition(time,position,speed){var nextPosition=this.__transportedQueue.time;while(nextPosition===position){var engine=this.__transportedQueue.head;var nextEnginePosition=engine.advancePosition(time,position,speed);if((speed>0&&nextEnginePosition>position||speed<0&&nextEnginePosition<position)&&(nextEnginePosition<Infinity&&nextEnginePosition>-Infinity)){nextPosition=this.__transportedQueue.move(engine,nextEnginePosition)}else{nextPosition=this.__transportedQueue.remove(engine)}}return nextPosition}},syncSpeed:{value:function syncSpeed(time,position,speed){var seek=arguments[3]===undefined?false:arguments[3];var lastSpeed=this.__speed;this.__time=time;this.__position=position;this.__speed=speed;if(speed!==lastSpeed||seek&&speed!==0){var nextPosition;if(seek||speed*lastSpeed<0){nextPosition=this.__syncTransportedPosition(time,position,speed)}else if(lastSpeed===0){nextPosition=this.__syncTransportedPosition(time,position,speed)}else if(speed===0){nextPosition=Infinity;this.__syncTransportedSpeed(time,position,0)}else{this.__syncTransportedSpeed(time,position,speed)}this.resetPosition(nextPosition)}}},add:{value:function add(engine){var _this=this;var startPosition=arguments[1]===undefined?-Infinity:arguments[1];var endPosition=arguments[2]===undefined?Infinity:arguments[2];var offsetPosition=arguments[3]===undefined?startPosition:arguments[3];return function(){var transported=null;if(offsetPosition===-Infinity)offsetPosition=0;if(engine.master)throw new Error("object has already been added to a master");if(engine.implementsTransported())transported=new TransportedTransported(_this,engine,startPosition,endPosition,offsetPosition);else if(engine.implementsSpeedControlled())transported=new TransportedSpeedControlled(_this,engine,startPosition,endPosition,offsetPosition);else if(engine.implementsScheduled())transported=new TransportedScheduled(_this,engine,startPosition,endPosition,offsetPosition);else throw new Error("object cannot be added to a transport");if(transported){var speed=_this.__speed;addDuplet(_this.__engines,_this.__transported,engine,transported);if(speed!==0){var nextEnginePosition=transported.syncPosition(_this.currentTime,_this.currentPosition,speed);var nextPosition=_this.__transportedQueue.insert(transported,nextEnginePosition);_this.resetPosition(nextPosition)}}return transported}()}},remove:{value:function remove(engineOrTransported){var engine=engineOrTransported;var transported=removeDuplet(this.__engines,this.__transported,engineOrTransported);if(!transported){engine=removeDuplet(this.__transported,this.__engines,engineOrTransported);transported=engineOrTransported}if(engine&&transported){var nextPosition=this.__transportedQueue.remove(transported);transported.destroy();if(this.__speed!==0)this.resetPosition(nextPosition)}else{throw new Error("object has not been added to this transport")}}},resetEnginePosition:{value:function resetEnginePosition(transported){var position=arguments[1]===undefined?undefined:arguments[1];var speed=this.__speed;if(speed!==0){if(position===undefined)position=transported.syncPosition(this.currentTime,this.currentPosition,speed);var nextPosition=this.__transportedQueue.move(transported,position);this.resetPosition(nextPosition)}}},clear:{value:function clear(){this.syncSpeed(this.currentTime,this.currentPosition,0);var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=_core.$for.getIterator(this.__transported),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var transported=_step.value;transported.destroy()}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]){_iterator["return"]()}}finally{if(_didIteratorError){throw _iteratorError}}}}}});return Transport}(TimeEngine);module.exports=Transport},{"../core/audio-context":10,"../core/time-engine":12,"../utils/priority-queue":22,"../utils/scheduling-queue":23,"./factories":17,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],22:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var PriorityQueue=function(){function PriorityQueue(){_classCallCheck(this,PriorityQueue);this.__objects=[];this.reverse=false}_createClass(PriorityQueue,{__objectIndex:{value:function __objectIndex(object){for(var i=0;i<this.__objects.length;i++){if(object===this.__objects[i][0]){return i}}return-1}},__removeObject:{value:function __removeObject(object){var index=this.__objectIndex(object);if(index>=0)this.__objects.splice(index,1);if(this.__objects.length>0){return this.__objects[0][1]}return Infinity}},__sortObjects:{value:function __sortObjects(){if(!this.reverse)this.__objects.sort(function(a,b){return a[1]-b[1]});else this.__objects.sort(function(a,b){return b[1]-a[1]})}},insert:{value:function insert(object,time){var sort=arguments[2]===undefined?true:arguments[2];if(time!==Infinity&&time!=-Infinity){this.__objects.push([object,time]);if(sort)this.__sortObjects();return this.__objects[0][1]}return this.__removeObject(object)}},move:{value:function move(object,time){if(time!==Infinity&&time!=-Infinity){var index=this.__objectIndex(object);if(index<0)this.__objects.push([object,time]);else this.__objects[index][1]=time;this.__sortObjects();return this.__objects[0][1]}return this.__removeObject(object)}},remove:{value:function remove(object){return this.__removeObject(object)}},clear:{value:function clear(){this.__objects.length=0;return Infinity}},head:{get:function(){if(this.__objects.length>0)return this.__objects[0][0];return null}},time:{get:function(){if(this.__objects.length>0)return this.__objects[0][1];return Infinity}}});return PriorityQueue}();module.exports=PriorityQueue},{"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26}],23:[function(require,module,exports){"use strict";var _classCallCheck=require("babel-runtime/helpers/class-call-check")["default"];var _inherits=require("babel-runtime/helpers/inherits")["default"];var _get=require("babel-runtime/helpers/get")["default"];var _createClass=require("babel-runtime/helpers/create-class")["default"];var _core=require("babel-runtime/core-js")["default"];var PriorityQueue=require("../utils/priority-queue");var TimeEngine=require("../core/time-engine");var defaultAudioContext=require("../core/audio-context");function arrayRemove(array,value){var index=array.indexOf(value);if(index>=0){array.splice(index,1);return true}return false}var SchedulingQueue=function(_TimeEngine){function SchedulingQueue(){_classCallCheck(this,SchedulingQueue);_get(_core.Object.getPrototypeOf(SchedulingQueue.prototype),"constructor",this).call(this);this.__queue=new PriorityQueue;this.__engines=[]}_inherits(SchedulingQueue,_TimeEngine);_createClass(SchedulingQueue,{advanceTime:{value:function advanceTime(time){var nextTime=this.__queue.time;while(nextTime<=time){var engine=this.__queue.head;var nextEngineTime=engine.advanceTime(time);if(!nextEngineTime){engine.master=null;arrayRemove(this.__engines,engine);nextTime=this.__queue.remove(engine)}else if(nextEngineTime>time&&nextEngineTime<Infinity){nextTime=this.__queue.move(engine,nextEngineTime)}else{nextTime=this.__queue.remove(engine)}}return nextTime}},currentTime:{get:function(){return 0}},add:{value:function add(engine){var time=arguments[1]===undefined?this.currentTime:arguments[1];engine.master=this;this.__engines.push(engine);var nextTime=this.__queue.insert(engine,time);this.resetTime(nextTime)}},remove:{value:function remove(engine){engine.master=null;arrayRemove(this.__engines,engine);var nextTime=this.__queue.remove(engine);this.resetTime(nextTime)}},resetEngineTime:{value:function resetEngineTime(engine){var time=arguments[1]===undefined?this.currentTime:arguments[1];var nextTime=this.__queue.move(engine,time);this.resetTime(nextTime)}},clear:{value:function clear(){this.__queue.clear();this.__engines.length=0;this.resetTime(Infinity)}}});return SchedulingQueue}(TimeEngine);module.exports=SchedulingQueue},{"../core/audio-context":10,"../core/time-engine":12,"../utils/priority-queue":22,"babel-runtime/core-js":24,"babel-runtime/helpers/class-call-check":25,"babel-runtime/helpers/create-class":26,"babel-runtime/helpers/get":27,"babel-runtime/helpers/inherits":28}],24:[function(require,module,exports){!function(global,framework,undefined){"use strict";var OBJECT="Object",FUNCTION="Function",ARRAY="Array",STRING="String",NUMBER="Number",REGEXP="RegExp",DATE="Date",MAP="Map",SET="Set",WEAKMAP="WeakMap",WEAKSET="WeakSet",SYMBOL="Symbol",PROMISE="Promise",MATH="Math",ARGUMENTS="Arguments",PROTOTYPE="prototype",CONSTRUCTOR="constructor",TO_STRING="toString",TO_STRING_TAG=TO_STRING+"Tag",TO_LOCALE="toLocaleString",HAS_OWN="hasOwnProperty",FOR_EACH="forEach",ITERATOR="iterator",FF_ITERATOR="@@"+ITERATOR,PROCESS="process",CREATE_ELEMENT="createElement",Function=global[FUNCTION],Object=global[OBJECT],Array=global[ARRAY],String=global[STRING],Number=global[NUMBER],RegExp=global[REGEXP],Date=global[DATE],Map=global[MAP],Set=global[SET],WeakMap=global[WEAKMAP],WeakSet=global[WEAKSET],Symbol=global[SYMBOL],Math=global[MATH],TypeError=global.TypeError,RangeError=global.RangeError,setTimeout=global.setTimeout,setImmediate=global.setImmediate,clearImmediate=global.clearImmediate,parseInt=global.parseInt,isFinite=global.isFinite,process=global[PROCESS],nextTick=process&&process.nextTick,document=global.document,html=document&&document.documentElement,navigator=global.navigator,define=global.define,console=global.console||{},ArrayProto=Array[PROTOTYPE],ObjectProto=Object[PROTOTYPE],FunctionProto=Function[PROTOTYPE],Infinity=1/0,DOT=".";function isObject(it){return it!==null&&(typeof it=="object"||typeof it=="function")}function isFunction(it){return typeof it=="function"}var isNative=ctx(/./.test,/\[native code\]\s*\}\s*$/,1);var toString=ObjectProto[TO_STRING];function setToStringTag(it,tag,stat){if(it&&!has(it=stat?it:it[PROTOTYPE],SYMBOL_TAG))hidden(it,SYMBOL_TAG,tag)}function cof(it){return toString.call(it).slice(8,-1)}function classof(it){var O,T;return it==undefined?it===undefined?"Undefined":"Null":typeof(T=(O=Object(it))[SYMBOL_TAG])=="string"?T:cof(O)}var call=FunctionProto.call,apply=FunctionProto.apply,REFERENCE_GET;function part(){var fn=assertFunction(this),length=arguments.length,args=Array(length),i=0,_=path._,holder=false;while(length>i)if((args[i]=arguments[i++])===_)holder=true;return function(){var that=this,_length=arguments.length,i=0,j=0,_args;if(!holder&&!_length)return invoke(fn,args,that);_args=args.slice();if(holder)for(;length>i;i++)if(_args[i]===_)_args[i]=arguments[j++];while(_length>j)_args.push(arguments[j++]);return invoke(fn,_args,that)}}function ctx(fn,that,length){assertFunction(fn);if(~length&&that===undefined)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}function invoke(fn,args,that){var un=that===undefined;switch(args.length|0){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3]);case 5:return un?fn(args[0],args[1],args[2],args[3],args[4]):fn.call(that,args[0],args[1],args[2],args[3],args[4])}return fn.apply(that,args)}var create=Object.create,getPrototypeOf=Object.getPrototypeOf,setPrototypeOf=Object.setPrototypeOf,defineProperty=Object.defineProperty,defineProperties=Object.defineProperties,getOwnDescriptor=Object.getOwnPropertyDescriptor,getKeys=Object.keys,getNames=Object.getOwnPropertyNames,getSymbols=Object.getOwnPropertySymbols,isFrozen=Object.isFrozen,has=ctx(call,ObjectProto[HAS_OWN],2),ES5Object=Object,Dict;function toObject(it){return ES5Object(assertDefined(it))}function returnIt(it){return it}function returnThis(){return this}function get(object,key){if(has(object,key))return object[key]}function ownKeys(it){assertObject(it);return getSymbols?getNames(it).concat(getSymbols(it)):getNames(it)}var assign=Object.assign||function(target,source){var T=Object(assertDefined(target)),l=arguments.length,i=1;while(l>i){var S=ES5Object(arguments[i++]),keys=getKeys(S),length=keys.length,j=0,key;while(length>j)T[key=keys[j++]]=S[key]}return T};function keyOf(object,el){var O=toObject(object),keys=getKeys(O),length=keys.length,index=0,key;while(length>index)if(O[key=keys[index++]]===el)return key}function array(it){return String(it).split(",")}var push=ArrayProto.push,unshift=ArrayProto.unshift,slice=ArrayProto.slice,splice=ArrayProto.splice,indexOf=ArrayProto.indexOf,forEach=ArrayProto[FOR_EACH];function createArrayMethod(type){var isMap=type==1,isFilter=type==2,isSome=type==3,isEvery=type==4,isFindIndex=type==6,noholes=type==5||isFindIndex;return function(callbackfn){var O=Object(assertDefined(this)),that=arguments[1],self=ES5Object(O),f=ctx(callbackfn,that,3),length=toLength(self.length),index=0,result=isMap?Array(length):isFilter?[]:undefined,val,res;for(;length>index;index++)if(noholes||index in self){val=self[index];res=f(val,index,O);if(type){if(isMap)result[index]=res;else if(res)switch(type){case 3:return true;case 5:return val;case 6:return index;case 2:result.push(val)}else if(isEvery)return false}}return isFindIndex?-1:isSome||isEvery?isEvery:result}}function createArrayContains(isContains){return function(el){var O=toObject(this),length=toLength(O.length),index=toIndex(arguments[1],length);if(isContains&&el!=el){for(;length>index;index++)if(sameNaN(O[index]))return isContains||index}else for(;length>index;index++)if(isContains||index in O){if(O[index]===el)return isContains||index}return!isContains&&-1}}function generic(A,B){return typeof A=="function"?A:B}var MAX_SAFE_INTEGER=9007199254740991,pow=Math.pow,abs=Math.abs,ceil=Math.ceil,floor=Math.floor,max=Math.max,min=Math.min,random=Math.random,trunc=Math.trunc||function(it){return(it>0?floor:ceil)(it)};function sameNaN(number){return number!=number}function toInteger(it){return isNaN(it)?0:trunc(it)}function toLength(it){return it>0?min(toInteger(it),MAX_SAFE_INTEGER):0}function toIndex(index,length){var index=toInteger(index);return index<0?max(index+length,0):min(index,length)}function lz(num){return num>9?num:"0"+num}function createReplacer(regExp,replace,isStatic){var replacer=isObject(replace)?function(part){return replace[part]}:replace;return function(it){return String(isStatic?it:this).replace(regExp,replacer)}}function createPointAt(toString){return function(pos){var s=String(assertDefined(this)),i=toInteger(pos),l=s.length,a,b;if(i<0||i>=l)return toString?"":undefined;a=s.charCodeAt(i);return a<55296||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?toString?s.charAt(i):a:toString?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536}}var REDUCE_ERROR="Reduce of empty object with no initial value";function assert(condition,msg1,msg2){if(!condition)throw TypeError(msg2?msg1+msg2:msg1)}function assertDefined(it){if(it==undefined)throw TypeError("Function called on null or undefined");return it}function assertFunction(it){assert(isFunction(it),it," is not a function!");return it}function assertObject(it){assert(isObject(it),it," is not an object!");return it}function assertInstance(it,Constructor,name){assert(it instanceof Constructor,name,": use the 'new' operator!")}function descriptor(bitmap,value){return{enumerable:!(bitmap&1),configurable:!(bitmap&2),writable:!(bitmap&4),value:value}}function simpleSet(object,key,value){object[key]=value;return object}function createDefiner(bitmap){return DESC?function(object,key,value){return defineProperty(object,key,descriptor(bitmap,value))}:simpleSet}function uid(key){return SYMBOL+"("+key+")_"+(++sid+random())[TO_STRING](36)}function getWellKnownSymbol(name,setter){return Symbol&&Symbol[name]||(setter?Symbol:safeSymbol)(SYMBOL+DOT+name)}var DESC=!!function(){try{return defineProperty({},"a",{get:function(){return 2}}).a==2}catch(e){}}(),sid=0,hidden=createDefiner(1),set=Symbol?simpleSet:hidden,safeSymbol=Symbol||uid;function assignHidden(target,src){for(var key in src)hidden(target,key,src[key]);return target}var SYMBOL_UNSCOPABLES=getWellKnownSymbol("unscopables"),ArrayUnscopables=ArrayProto[SYMBOL_UNSCOPABLES]||{},SYMBOL_TAG=getWellKnownSymbol(TO_STRING_TAG),SYMBOL_SPECIES=getWellKnownSymbol("species"),SYMBOL_ITERATOR;function setSpecies(C){if(DESC&&(framework||!isNative(C)))defineProperty(C,SYMBOL_SPECIES,{configurable:true,get:returnThis})}var NODE=cof(process)==PROCESS,core={},path=framework?global:core,old=global.core,exportGlobal,FORCED=1,GLOBAL=2,STATIC=4,PROTO=8,BIND=16,WRAP=32;function $define(type,name,source){var key,own,out,exp,isGlobal=type&GLOBAL,target=isGlobal?global:type&STATIC?global[name]:(global[name]||ObjectProto)[PROTOTYPE],exports=isGlobal?core:core[name]||(core[name]={});if(isGlobal)source=name;for(key in source){own=!(type&FORCED)&&target&&key in target&&(!isFunction(target[key])||isNative(target[key]));out=(own?target:source)[key];if(!framework&&isGlobal&&!isFunction(target[key]))exp=source[key];else if(type&BIND&&own)exp=ctx(out,global);else if(type&WRAP&&!framework&&target[key]==out){exp=function(param){return this instanceof out?new out(param):out(param)};exp[PROTOTYPE]=out[PROTOTYPE]}else exp=type&PROTO&&isFunction(out)?ctx(call,out):out;if(framework&&target&&!own){if(isGlobal)target[key]=out;else delete target[key]&&hidden(target,key,out)}if(exports[key]!=out)hidden(exports,key,exp)}}if(typeof module!="undefined"&&module.exports)module.exports=core;else if(isFunction(define)&&define.amd)define(function(){return core});else exportGlobal=true;if(exportGlobal||framework){core.noConflict=function(){global.core=old;return core};global.core=core}SYMBOL_ITERATOR=getWellKnownSymbol(ITERATOR);var ITER=safeSymbol("iter"),KEY=1,VALUE=2,Iterators={},IteratorPrototype={},BUGGY_ITERATORS="keys"in ArrayProto&&!("next"in[].keys());setIterator(IteratorPrototype,returnThis);function setIterator(O,value){hidden(O,SYMBOL_ITERATOR,value);FF_ITERATOR in ArrayProto&&hidden(O,FF_ITERATOR,value)}function createIterator(Constructor,NAME,next,proto){Constructor[PROTOTYPE]=create(proto||IteratorPrototype,{next:descriptor(1,next)});setToStringTag(Constructor,NAME+" Iterator")}function defineIterator(Constructor,NAME,value,DEFAULT){var proto=Constructor[PROTOTYPE],iter=get(proto,SYMBOL_ITERATOR)||get(proto,FF_ITERATOR)||DEFAULT&&get(proto,DEFAULT)||value;if(framework){setIterator(proto,iter);if(iter!==value){var iterProto=getPrototypeOf(iter.call(new Constructor));setToStringTag(iterProto,NAME+" Iterator",true);has(proto,FF_ITERATOR)&&setIterator(iterProto,returnThis)}}Iterators[NAME]=iter;Iterators[NAME+" Iterator"]=returnThis;return iter}function defineStdIterators(Base,NAME,Constructor,next,DEFAULT,IS_SET){function createIter(kind){return function(){return new Constructor(this,kind)}}createIterator(Constructor,NAME,next);var entries=createIter(KEY+VALUE),values=createIter(VALUE);if(DEFAULT==VALUE)values=defineIterator(Base,NAME,values,"values");else entries=defineIterator(Base,NAME,entries,"entries");if(DEFAULT){$define(PROTO+FORCED*BUGGY_ITERATORS,NAME,{entries:entries,keys:IS_SET?values:createIter(KEY),values:values})}}function iterResult(done,value){return{value:value,done:!!done}}function isIterable(it){var O=Object(it),Symbol=global[SYMBOL],hasExt=(Symbol&&Symbol[ITERATOR]||FF_ITERATOR)in O;return hasExt||SYMBOL_ITERATOR in O||has(Iterators,classof(O))}function getIterator(it){var Symbol=global[SYMBOL],ext=it[Symbol&&Symbol[ITERATOR]||FF_ITERATOR],getIter=ext||it[SYMBOL_ITERATOR]||Iterators[classof(it)];return assertObject(getIter.call(it))}function stepCall(fn,value,entries){return entries?invoke(fn,value):fn(value)}function checkDangerIterClosing(fn){var danger=true;var O={next:function(){throw 1},"return":function(){danger=false}};O[SYMBOL_ITERATOR]=returnThis;try{fn(O)}catch(e){}return danger}function closeIterator(iterator){var ret=iterator["return"];if(ret!==undefined)ret.call(iterator)}function safeIterClose(exec,iterator){try{exec(iterator)}catch(e){closeIterator(iterator);throw e}}function forOf(iterable,entries,fn,that){safeIterClose(function(iterator){var f=ctx(fn,that,entries?2:1),step;while(!(step=iterator.next()).done)if(stepCall(f,step.value,entries)===false){return closeIterator(iterator)}},getIterator(iterable))}!function(TAG,SymbolRegistry,AllSymbols,setter){if(!isNative(Symbol)){Symbol=function(description){assert(!(this instanceof Symbol),SYMBOL+" is not a "+CONSTRUCTOR);var tag=uid(description),sym=set(create(Symbol[PROTOTYPE]),TAG,tag);AllSymbols[tag]=sym;DESC&&setter&&defineProperty(ObjectProto,tag,{configurable:true,set:function(value){hidden(this,tag,value)}});return sym};hidden(Symbol[PROTOTYPE],TO_STRING,function(){return this[TAG]})}$define(GLOBAL+WRAP,{Symbol:Symbol});var symbolStatics={"for":function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=Symbol(key)},iterator:SYMBOL_ITERATOR||getWellKnownSymbol(ITERATOR),keyFor:part.call(keyOf,SymbolRegistry),species:SYMBOL_SPECIES,toStringTag:SYMBOL_TAG=getWellKnownSymbol(TO_STRING_TAG,true),unscopables:SYMBOL_UNSCOPABLES,pure:safeSymbol,set:set,useSetter:function(){setter=true},useSimple:function(){setter=false}};forEach.call(array("hasInstance,isConcatSpreadable,match,replace,search,split,toPrimitive"),function(it){symbolStatics[it]=getWellKnownSymbol(it)});$define(STATIC,SYMBOL,symbolStatics);setToStringTag(Symbol,SYMBOL);$define(STATIC+FORCED*!isNative(Symbol),OBJECT,{getOwnPropertyNames:function(it){var names=getNames(toObject(it)),result=[],key,i=0;while(names.length>i)has(AllSymbols,key=names[i++])||result.push(key);return result},getOwnPropertySymbols:function(it){var names=getNames(toObject(it)),result=[],key,i=0;while(names.length>i)has(AllSymbols,key=names[i++])&&result.push(AllSymbols[key]);return result}});setToStringTag(Math,MATH,true);setToStringTag(global.JSON,"JSON",true)}(safeSymbol("tag"),{},{},true);!function(){var objectStatic={assign:assign,is:function(x,y){return x===y?x!==0||1/x===1/y:x!=x&&y!=y}};"__proto__"in ObjectProto&&function(buggy,set){try{set=ctx(call,getOwnDescriptor(ObjectProto,"__proto__").set,2);set({},ArrayProto)}catch(e){buggy=true}objectStatic.setPrototypeOf=setPrototypeOf=setPrototypeOf||function(O,proto){assertObject(O);assert(proto===null||isObject(proto),proto,": can't set as prototype!");if(buggy)O.__proto__=proto;else set(O,proto);return O}}();$define(STATIC,OBJECT,objectStatic)}();!function(){function wrapObjectMethod(key,MODE){var fn=Object[key],exp=core[OBJECT][key],f=0,o={};if(!exp||isNative(exp)){o[key]=MODE==1?function(it){return isObject(it)?fn(it):it}:MODE==2?function(it){return isObject(it)?fn(it):true}:MODE==3?function(it){return isObject(it)?fn(it):false}:MODE==4?function(it,key){return fn(toObject(it),key)}:function(it){return fn(toObject(it))};try{fn(DOT)}catch(e){f=1}$define(STATIC+FORCED*f,OBJECT,o)}}wrapObjectMethod("freeze",1);wrapObjectMethod("seal",1);wrapObjectMethod("preventExtensions",1);wrapObjectMethod("isFrozen",2);wrapObjectMethod("isSealed",2);wrapObjectMethod("isExtensible",3);wrapObjectMethod("getOwnPropertyDescriptor",4);wrapObjectMethod("getPrototypeOf");wrapObjectMethod("keys");wrapObjectMethod("getOwnPropertyNames")}();!function(isInteger){$define(STATIC,NUMBER,{EPSILON:pow(2,-52),isFinite:function(it){return typeof it=="number"&&isFinite(it)},isInteger:isInteger,isNaN:sameNaN,isSafeInteger:function(number){return isInteger(number)&&abs(number)<=MAX_SAFE_INTEGER},MAX_SAFE_INTEGER:MAX_SAFE_INTEGER,MIN_SAFE_INTEGER:-MAX_SAFE_INTEGER,parseFloat:parseFloat,parseInt:parseInt})}(Number.isInteger||function(it){return!isObject(it)&&isFinite(it)&&floor(it)===it});!function(){var E=Math.E,exp=Math.exp,log=Math.log,sqrt=Math.sqrt,sign=Math.sign||function(x){return(x=+x)==0||x!=x?x:x<0?-1:1};function asinh(x){return!isFinite(x=+x)||x==0?x:x<0?-asinh(-x):log(x+sqrt(x*x+1))}function expm1(x){return(x=+x)==0?x:x>-1e-6&&x<1e-6?x+x*x/2:exp(x)-1}$define(STATIC,MATH,{acosh:function(x){return(x=+x)<1?NaN:isFinite(x)?log(x/E+sqrt(x+1)*sqrt(x-1)/E)+1:x},asinh:asinh,atanh:function(x){return(x=+x)==0?x:log((1+x)/(1-x))/2},cbrt:function(x){return sign(x=+x)*pow(abs(x),1/3)},clz32:function(x){return(x>>>=0)?32-x[TO_STRING](2).length:32},cosh:function(x){return(exp(x=+x)+exp(-x))/2},expm1:expm1,fround:function(x){return new Float32Array([x])[0]},hypot:function(value1,value2){var sum=0,len1=arguments.length,len2=len1,args=Array(len1),larg=-Infinity,arg;while(len1--){arg=args[len1]=+arguments[len1];if(arg==Infinity||arg==-Infinity)return Infinity;if(arg>larg)larg=arg}larg=arg||1;while(len2--)sum+=pow(args[len2]/larg,2);return larg*sqrt(sum)},imul:function(x,y){var UInt16=65535,xn=+x,yn=+y,xl=UInt16&xn,yl=UInt16&yn;return 0|xl*yl+((UInt16&xn>>>16)*yl+xl*(UInt16&yn>>>16)<<16>>>0)},log1p:function(x){return(x=+x)>-1e-8&&x<1e-8?x-x*x/2:log(1+x)},log10:function(x){return log(x)/Math.LN10},log2:function(x){return log(x)/Math.LN2},sign:sign,sinh:function(x){return abs(x=+x)<1?(expm1(x)-expm1(-x))/2:(exp(x-1)-exp(-x-1))*(E/2)},tanh:function(x){var a=expm1(x=+x),b=expm1(-x);return a==Infinity?1:b==Infinity?-1:(a-b)/(exp(x)+exp(-x))},trunc:trunc})}();
!function(fromCharCode){function assertNotRegExp(it){if(cof(it)==REGEXP)throw TypeError()}$define(STATIC,STRING,{fromCodePoint:function(x){var res=[],len=arguments.length,i=0,code;while(len>i){code=+arguments[i++];if(toIndex(code,1114111)!==code)throw RangeError(code+" is not a valid code point");res.push(code<65536?fromCharCode(code):fromCharCode(((code-=65536)>>10)+55296,code%1024+56320))}return res.join("")},raw:function(callSite){var raw=toObject(callSite.raw),len=toLength(raw.length),sln=arguments.length,res=[],i=0;while(len>i){res.push(String(raw[i++]));if(i<sln)res.push(String(arguments[i]))}return res.join("")}});$define(PROTO,STRING,{codePointAt:createPointAt(false),endsWith:function(searchString){assertNotRegExp(searchString);var that=String(assertDefined(this)),endPosition=arguments[1],len=toLength(that.length),end=endPosition===undefined?len:min(toLength(endPosition),len);searchString+="";return that.slice(end-searchString.length,end)===searchString},includes:function(searchString){assertNotRegExp(searchString);return!!~String(assertDefined(this)).indexOf(searchString,arguments[1])},repeat:function(count){var str=String(assertDefined(this)),res="",n=toInteger(count);if(0>n||n==Infinity)throw RangeError("Count can't be negative");for(;n>0;(n>>>=1)&&(str+=str))if(n&1)res+=str;return res},startsWith:function(searchString){assertNotRegExp(searchString);var that=String(assertDefined(this)),index=toLength(min(arguments[1],that.length));searchString+="";return that.slice(index,index+searchString.length)===searchString}})}(String.fromCharCode);!function(){$define(STATIC+FORCED*checkDangerIterClosing(Array.from),ARRAY,{from:function(arrayLike){var O=Object(assertDefined(arrayLike)),mapfn=arguments[1],mapping=mapfn!==undefined,f=mapping?ctx(mapfn,arguments[2],2):undefined,index=0,length,result,step;if(isIterable(O)){result=new(generic(this,Array));safeIterClose(function(iterator){for(;!(step=iterator.next()).done;index++){result[index]=mapping?f(step.value,index):step.value}},getIterator(O))}else{result=new(generic(this,Array))(length=toLength(O.length));for(;length>index;index++){result[index]=mapping?f(O[index],index):O[index]}}result.length=index;return result}});$define(STATIC,ARRAY,{of:function(){var index=0,length=arguments.length,result=new(generic(this,Array))(length);while(length>index)result[index]=arguments[index++];result.length=length;return result}});setSpecies(Array)}();!function(){$define(PROTO,ARRAY,{copyWithin:function(target,start){var O=Object(assertDefined(this)),len=toLength(O.length),to=toIndex(target,len),from=toIndex(start,len),end=arguments[2],fin=end===undefined?len:toIndex(end,len),count=min(fin-from,len-to),inc=1;if(from<to&&to<from+count){inc=-1;from=from+count-1;to=to+count-1}while(count-- >0){if(from in O)O[to]=O[from];else delete O[to];to+=inc;from+=inc}return O},fill:function(value){var O=Object(assertDefined(this)),length=toLength(O.length),index=toIndex(arguments[1],length),end=arguments[2],endPos=end===undefined?length:toIndex(end,length);while(endPos>index)O[index++]=value;return O},find:createArrayMethod(5),findIndex:createArrayMethod(6)});if(framework){forEach.call(array("find,findIndex,fill,copyWithin,entries,keys,values"),function(it){ArrayUnscopables[it]=true});SYMBOL_UNSCOPABLES in ArrayProto||hidden(ArrayProto,SYMBOL_UNSCOPABLES,ArrayUnscopables)}}();!function(at){defineStdIterators(Array,ARRAY,function(iterated,kind){set(this,ITER,{o:toObject(iterated),i:0,k:kind})},function(){var iter=this[ITER],O=iter.o,kind=iter.k,index=iter.i++;if(!O||index>=O.length){iter.o=undefined;return iterResult(1)}if(kind==KEY)return iterResult(0,index);if(kind==VALUE)return iterResult(0,O[index]);return iterResult(0,[index,O[index]])},VALUE);Iterators[ARGUMENTS]=Iterators[ARRAY];defineStdIterators(String,STRING,function(iterated){set(this,ITER,{o:String(iterated),i:0})},function(){var iter=this[ITER],O=iter.o,index=iter.i,point;if(index>=O.length)return iterResult(1);point=at.call(O,index);iter.i+=point.length;return iterResult(0,point)})}(createPointAt(true));isFunction(setImmediate)&&isFunction(clearImmediate)||function(ONREADYSTATECHANGE){var postMessage=global.postMessage,addEventListener=global.addEventListener,MessageChannel=global.MessageChannel,counter=0,queue={},defer,channel,port;setImmediate=function(fn){var args=[],i=1;while(arguments.length>i)args.push(arguments[i++]);queue[++counter]=function(){invoke(isFunction(fn)?fn:Function(fn),args)};defer(counter);return counter};clearImmediate=function(id){delete queue[id]};function run(id){if(has(queue,id)){var fn=queue[id];delete queue[id];fn()}}function listner(event){run(event.data)}if(NODE){defer=function(id){nextTick(part.call(run,id))}}else if(addEventListener&&isFunction(postMessage)&&!global.importScripts){defer=function(id){postMessage(id,"*")};addEventListener("message",listner,false)}else if(isFunction(MessageChannel)){channel=new MessageChannel;port=channel.port2;channel.port1.onmessage=listner;defer=ctx(port.postMessage,port,1)}else if(document&&ONREADYSTATECHANGE in document[CREATE_ELEMENT]("script")){defer=function(id){html.appendChild(document[CREATE_ELEMENT]("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this);run(id)}}}else{defer=function(id){setTimeout(run,0,id)}}}("onreadystatechange");$define(GLOBAL+BIND,{setImmediate:setImmediate,clearImmediate:clearImmediate});!function(Promise,test){isFunction(Promise)&&isFunction(Promise.resolve)&&Promise.resolve(test=new Promise(function(){}))==test||function(asap,RECORD){function isThenable(it){var then;if(isObject(it))then=it.then;return isFunction(then)?then:false}function handledRejectionOrHasOnRejected(promise){var record=promise[RECORD],chain=record.c,i=0,react;if(record.h)return true;while(chain.length>i){react=chain[i++];if(react.fail||handledRejectionOrHasOnRejected(react.P))return true}}function notify(record,reject){var chain=record.c;if(reject||chain.length)asap(function(){var promise=record.p,value=record.v,ok=record.s==1,i=0;if(reject&&!handledRejectionOrHasOnRejected(promise)){setTimeout(function(){if(!handledRejectionOrHasOnRejected(promise)){if(NODE){if(!process.emit("unhandledRejection",value,promise)){}}else if(isFunction(console.error)){console.error("Unhandled promise rejection",value)}}},1e3)}else while(chain.length>i)!function(react){var cb=ok?react.ok:react.fail,ret,then;try{if(cb){if(!ok)record.h=true;ret=cb===true?value:cb(value);if(ret===react.P){react.rej(TypeError(PROMISE+"-chain cycle"))}else if(then=isThenable(ret)){then.call(ret,react.res,react.rej)}else react.res(ret)}else react.rej(value)}catch(err){react.rej(err)}}(chain[i++]);chain.length=0})}function resolve(value){var record=this,then,wrapper;if(record.d)return;record.d=true;record=record.r||record;try{if(then=isThenable(value)){wrapper={r:record,d:false};then.call(value,ctx(resolve,wrapper,1),ctx(reject,wrapper,1))}else{record.v=value;record.s=1;notify(record)}}catch(err){reject.call(wrapper||{r:record,d:false},err)}}function reject(value){var record=this;if(record.d)return;record.d=true;record=record.r||record;record.v=value;record.s=2;notify(record,true)}function getConstructor(C){var S=assertObject(C)[SYMBOL_SPECIES];return S!=undefined?S:C}Promise=function(executor){assertFunction(executor);assertInstance(this,Promise,PROMISE);var record={p:this,c:[],s:0,d:false,v:undefined,h:false};hidden(this,RECORD,record);try{executor(ctx(resolve,record,1),ctx(reject,record,1))}catch(err){reject.call(record,err)}};assignHidden(Promise[PROTOTYPE],{then:function(onFulfilled,onRejected){var S=assertObject(assertObject(this)[CONSTRUCTOR])[SYMBOL_SPECIES];var react={ok:isFunction(onFulfilled)?onFulfilled:true,fail:isFunction(onRejected)?onRejected:false},P=react.P=new(S!=undefined?S:Promise)(function(resolve,reject){react.res=assertFunction(resolve);react.rej=assertFunction(reject)}),record=this[RECORD];record.c.push(react);record.s&&notify(record);return P},"catch":function(onRejected){return this.then(undefined,onRejected)}});assignHidden(Promise,{all:function(iterable){var Promise=getConstructor(this),values=[];return new Promise(function(resolve,reject){forOf(iterable,false,push,values);var remaining=values.length,results=Array(remaining);if(remaining)forEach.call(values,function(promise,index){Promise.resolve(promise).then(function(value){results[index]=value;--remaining||resolve(results)},reject)});else resolve(results)})},race:function(iterable){var Promise=getConstructor(this);return new Promise(function(resolve,reject){forOf(iterable,false,function(promise){Promise.resolve(promise).then(resolve,reject)})})},reject:function(r){return new(getConstructor(this))(function(resolve,reject){reject(r)})},resolve:function(x){return isObject(x)&&RECORD in x&&getPrototypeOf(x)===this[PROTOTYPE]?x:new(getConstructor(this))(function(resolve,reject){resolve(x)})}})}(nextTick||setImmediate,safeSymbol("record"));setToStringTag(Promise,PROMISE);setSpecies(Promise);$define(GLOBAL+FORCED*!isNative(Promise),{Promise:Promise})}(global[PROMISE]);!function(){var UID=safeSymbol("uid"),O1=safeSymbol("O1"),WEAK=safeSymbol("weak"),LEAK=safeSymbol("leak"),LAST=safeSymbol("last"),FIRST=safeSymbol("first"),SIZE=DESC?safeSymbol("size"):"size",uid=0,tmp={};function getCollection(C,NAME,methods,commonMethods,isMap,isWeak){var ADDER=isMap?"set":"add",proto=C&&C[PROTOTYPE],O={};function initFromIterable(that,iterable){if(iterable!=undefined)forOf(iterable,isMap,that[ADDER],that);return that}function fixSVZ(key,chain){var method=proto[key];if(framework)proto[key]=function(a,b){var result=method.call(this,a===0?0:a,b);return chain?this:result}}if(!isNative(C)||!(isWeak||!BUGGY_ITERATORS&&has(proto,FOR_EACH)&&has(proto,"entries"))){C=isWeak?function(iterable){assertInstance(this,C,NAME);set(this,UID,uid++);initFromIterable(this,iterable)}:function(iterable){var that=this;assertInstance(that,C,NAME);set(that,O1,create(null));set(that,SIZE,0);set(that,LAST,undefined);set(that,FIRST,undefined);initFromIterable(that,iterable)};assignHidden(assignHidden(C[PROTOTYPE],methods),commonMethods);isWeak||!DESC||defineProperty(C[PROTOTYPE],"size",{get:function(){return assertDefined(this[SIZE])}})}else{var Native=C,inst=new C,chain=inst[ADDER](isWeak?{}:-0,1),buggyZero;if(checkDangerIterClosing(function(O){new C(O)})){C=function(iterable){assertInstance(this,C,NAME);return initFromIterable(new Native,iterable)};C[PROTOTYPE]=proto;if(framework)proto[CONSTRUCTOR]=C}isWeak||inst[FOR_EACH](function(val,key){buggyZero=1/key===-Infinity});if(buggyZero){fixSVZ("delete");fixSVZ("has");isMap&&fixSVZ("get")}if(buggyZero||chain!==inst)fixSVZ(ADDER,true)}setToStringTag(C,NAME);setSpecies(C);O[NAME]=C;$define(GLOBAL+WRAP+FORCED*!isNative(C),O);isWeak||defineStdIterators(C,NAME,function(iterated,kind){set(this,ITER,{o:iterated,k:kind})},function(){var iter=this[ITER],kind=iter.k,entry=iter.l;while(entry&&entry.r)entry=entry.p;if(!iter.o||!(iter.l=entry=entry?entry.n:iter.o[FIRST])){iter.o=undefined;return iterResult(1)}if(kind==KEY)return iterResult(0,entry.k);if(kind==VALUE)return iterResult(0,entry.v);return iterResult(0,[entry.k,entry.v])},isMap?KEY+VALUE:VALUE,!isMap);return C}function fastKey(it,create){if(!isObject(it))return(typeof it=="string"?"S":"P")+it;if(isFrozen(it))return"F";if(!has(it,UID)){if(!create)return"E";hidden(it,UID,++uid)}return"O"+it[UID]}function getEntry(that,key){var index=fastKey(key),entry;if(index!="F")return that[O1][index];for(entry=that[FIRST];entry;entry=entry.n){if(entry.k==key)return entry}}function def(that,key,value){var entry=getEntry(that,key),prev,index;if(entry)entry.v=value;else{that[LAST]=entry={i:index=fastKey(key,true),k:key,v:value,p:prev=that[LAST],n:undefined,r:false};if(!that[FIRST])that[FIRST]=entry;if(prev)prev.n=entry;that[SIZE]++;if(index!="F")that[O1][index]=entry}return that}var collectionMethods={clear:function(){for(var that=this,data=that[O1],entry=that[FIRST];entry;entry=entry.n){entry.r=true;if(entry.p)entry.p=entry.p.n=undefined;delete data[entry.i]}that[FIRST]=that[LAST]=undefined;that[SIZE]=0},"delete":function(key){var that=this,entry=getEntry(that,key);if(entry){var next=entry.n,prev=entry.p;delete that[O1][entry.i];entry.r=true;if(prev)prev.n=next;if(next)next.p=prev;if(that[FIRST]==entry)that[FIRST]=next;if(that[LAST]==entry)that[LAST]=prev;that[SIZE]--}return!!entry},forEach:function(callbackfn){var f=ctx(callbackfn,arguments[1],3),entry;while(entry=entry?entry.n:this[FIRST]){f(entry.v,entry.k,this);while(entry&&entry.r)entry=entry.p}},has:function(key){return!!getEntry(this,key)}};Map=getCollection(Map,MAP,{get:function(key){var entry=getEntry(this,key);return entry&&entry.v},set:function(key,value){return def(this,key===0?0:key,value)}},collectionMethods,true);Set=getCollection(Set,SET,{add:function(value){return def(this,value=value===0?0:value,value)}},collectionMethods);function defWeak(that,key,value){if(isFrozen(assertObject(key)))leakStore(that).set(key,value);else{has(key,WEAK)||hidden(key,WEAK,{});key[WEAK][that[UID]]=value}return that}function leakStore(that){return that[LEAK]||hidden(that,LEAK,new Map)[LEAK]}var weakMethods={"delete":function(key){if(!isObject(key))return false;if(isFrozen(key))return leakStore(this)["delete"](key);return has(key,WEAK)&&has(key[WEAK],this[UID])&&delete key[WEAK][this[UID]]},has:function(key){if(!isObject(key))return false;if(isFrozen(key))return leakStore(this).has(key);return has(key,WEAK)&&has(key[WEAK],this[UID])}};WeakMap=getCollection(WeakMap,WEAKMAP,{get:function(key){if(isObject(key)){if(isFrozen(key))return leakStore(this).get(key);if(has(key,WEAK))return key[WEAK][this[UID]]}},set:function(key,value){return defWeak(this,key,value)}},weakMethods,true,true);if(framework&&(new WeakMap).set(Object.freeze(tmp),7).get(tmp)!=7){forEach.call(array("delete,has,get,set"),function(key){var method=WeakMap[PROTOTYPE][key];WeakMap[PROTOTYPE][key]=function(a,b){if(isObject(a)&&isFrozen(a)){var result=leakStore(this)[key](a,b);return key=="set"?this:result}return method.call(this,a,b)}})}WeakSet=getCollection(WeakSet,WEAKSET,{add:function(value){return defWeak(this,value,true)}},weakMethods,false,true)}();!function(){function Enumerate(iterated){var keys=[],key;for(key in iterated)keys.push(key);set(this,ITER,{o:iterated,a:keys,i:0})}createIterator(Enumerate,OBJECT,function(){var iter=this[ITER],keys=iter.a,key;do{if(iter.i>=keys.length)return iterResult(1)}while(!((key=keys[iter.i++])in iter.o));return iterResult(0,key)});function wrap(fn){return function(it){assertObject(it);try{return fn.apply(undefined,arguments),true}catch(e){return false}}}function reflectGet(target,propertyKey){var receiver=arguments.length<3?target:arguments[2],desc=getOwnDescriptor(assertObject(target),propertyKey),proto;if(desc)return has(desc,"value")?desc.value:desc.get===undefined?undefined:desc.get.call(receiver);return isObject(proto=getPrototypeOf(target))?reflectGet(proto,propertyKey,receiver):undefined}function reflectSet(target,propertyKey,V){var receiver=arguments.length<4?target:arguments[3],ownDesc=getOwnDescriptor(assertObject(target),propertyKey),existingDescriptor,proto;if(!ownDesc){if(isObject(proto=getPrototypeOf(target))){return reflectSet(proto,propertyKey,V,receiver)}ownDesc=descriptor(0)}if(has(ownDesc,"value")){if(ownDesc.writable===false||!isObject(receiver))return false;existingDescriptor=getOwnDescriptor(receiver,propertyKey)||descriptor(0);existingDescriptor.value=V;return defineProperty(receiver,propertyKey,existingDescriptor),true}return ownDesc.set===undefined?false:(ownDesc.set.call(receiver,V),true)}var isExtensible=Object.isExtensible||returnIt;var reflect={apply:ctx(call,apply,3),construct:function(target,argumentsList){var proto=assertFunction(arguments.length<3?target:arguments[2])[PROTOTYPE],instance=create(isObject(proto)?proto:ObjectProto),result=apply.call(target,instance,argumentsList);return isObject(result)?result:instance},defineProperty:wrap(defineProperty),deleteProperty:function(target,propertyKey){var desc=getOwnDescriptor(assertObject(target),propertyKey);return desc&&!desc.configurable?false:delete target[propertyKey]},enumerate:function(target){return new Enumerate(assertObject(target))},get:reflectGet,getOwnPropertyDescriptor:function(target,propertyKey){return getOwnDescriptor(assertObject(target),propertyKey)},getPrototypeOf:function(target){return getPrototypeOf(assertObject(target))},has:function(target,propertyKey){return propertyKey in target},isExtensible:function(target){return!!isExtensible(assertObject(target))},ownKeys:ownKeys,preventExtensions:wrap(Object.preventExtensions||returnIt),set:reflectSet};if(setPrototypeOf)reflect.setPrototypeOf=function(target,proto){return setPrototypeOf(assertObject(target),proto),true};$define(GLOBAL,{Reflect:{}});$define(STATIC,"Reflect",reflect)}();!function(){$define(PROTO,ARRAY,{includes:createArrayContains(true)});$define(PROTO,STRING,{at:createPointAt(true)});function createObjectToArray(isEntries){return function(object){var O=toObject(object),keys=getKeys(object),length=keys.length,i=0,result=Array(length),key;if(isEntries)while(length>i)result[i]=[key=keys[i++],O[key]];else while(length>i)result[i]=O[keys[i++]];return result}}$define(STATIC,OBJECT,{getOwnPropertyDescriptors:function(object){var O=toObject(object),result={};forEach.call(ownKeys(O),function(key){defineProperty(result,key,descriptor(0,getOwnDescriptor(O,key)))});return result},values:createObjectToArray(false),entries:createObjectToArray(true)});$define(STATIC,REGEXP,{escape:createReplacer(/([\\\-[\]{}()*+?.,^$|])/g,"\\$1",true)})}();!function(REFERENCE){REFERENCE_GET=getWellKnownSymbol(REFERENCE+"Get",true);var REFERENCE_SET=getWellKnownSymbol(REFERENCE+SET,true),REFERENCE_DELETE=getWellKnownSymbol(REFERENCE+"Delete",true);$define(STATIC,SYMBOL,{referenceGet:REFERENCE_GET,referenceSet:REFERENCE_SET,referenceDelete:REFERENCE_DELETE});hidden(FunctionProto,REFERENCE_GET,returnThis);function setMapMethods(Constructor){if(Constructor){var MapProto=Constructor[PROTOTYPE];hidden(MapProto,REFERENCE_GET,MapProto.get);hidden(MapProto,REFERENCE_SET,MapProto.set);hidden(MapProto,REFERENCE_DELETE,MapProto["delete"])}}setMapMethods(Map);setMapMethods(WeakMap)}("reference");!function(DICT){Dict=function(iterable){var dict=create(null);if(iterable!=undefined){if(isIterable(iterable)){forOf(iterable,true,function(key,value){dict[key]=value})}else assign(dict,iterable)}return dict};Dict[PROTOTYPE]=null;function DictIterator(iterated,kind){set(this,ITER,{o:toObject(iterated),a:getKeys(iterated),i:0,k:kind})}createIterator(DictIterator,DICT,function(){var iter=this[ITER],O=iter.o,keys=iter.a,kind=iter.k,key;do{if(iter.i>=keys.length){iter.o=undefined;return iterResult(1)}}while(!has(O,key=keys[iter.i++]));if(kind==KEY)return iterResult(0,key);if(kind==VALUE)return iterResult(0,O[key]);return iterResult(0,[key,O[key]])});function createDictIter(kind){return function(it){return new DictIterator(it,kind)}}function createDictMethod(type){var isMap=type==1,isEvery=type==4;return function(object,callbackfn,that){var f=ctx(callbackfn,that,3),O=toObject(object),result=isMap||type==7||type==2?new(generic(this,Dict)):undefined,key,val,res;for(key in O)if(has(O,key)){val=O[key];res=f(val,key,object);if(type){if(isMap)result[key]=res;else if(res)switch(type){case 2:result[key]=val;break;case 3:return true;case 5:return val;case 6:return key;case 7:result[res[0]]=res[1]}else if(isEvery)return false}}return type==3||isEvery?isEvery:result}}function createDictReduce(isTurn){return function(object,mapfn,init){assertFunction(mapfn);var O=toObject(object),keys=getKeys(O),length=keys.length,i=0,memo,key,result;if(isTurn)memo=init==undefined?new(generic(this,Dict)):Object(init);else if(arguments.length<3){assert(length,REDUCE_ERROR);memo=O[keys[i++]]}else memo=Object(init);while(length>i)if(has(O,key=keys[i++])){result=mapfn(memo,O[key],key,object);if(isTurn){if(result===false)break}else memo=result}return memo}}var findKey=createDictMethod(6);function includes(object,el){return(el==el?keyOf(object,el):findKey(object,sameNaN))!==undefined}var dictMethods={keys:createDictIter(KEY),values:createDictIter(VALUE),entries:createDictIter(KEY+VALUE),forEach:createDictMethod(0),map:createDictMethod(1),filter:createDictMethod(2),some:createDictMethod(3),every:createDictMethod(4),find:createDictMethod(5),findKey:findKey,mapPairs:createDictMethod(7),reduce:createDictReduce(false),turn:createDictReduce(true),keyOf:keyOf,includes:includes,has:has,get:get,set:createDefiner(0),isDict:function(it){return isObject(it)&&getPrototypeOf(it)===Dict[PROTOTYPE]}};if(REFERENCE_GET)for(var key in dictMethods)!function(fn){function method(){for(var args=[this],i=0;i<arguments.length;)args.push(arguments[i++]);return invoke(fn,args)}fn[REFERENCE_GET]=function(){return method}}(dictMethods[key]);$define(GLOBAL+FORCED,{Dict:assignHidden(Dict,dictMethods)})}("Dict");!function(ENTRIES,FN){function $for(iterable,entries){if(!(this instanceof $for))return new $for(iterable,entries);this[ITER]=getIterator(iterable);this[ENTRIES]=!!entries}createIterator($for,"Wrapper",function(){return this[ITER].next()});var $forProto=$for[PROTOTYPE];setIterator($forProto,function(){return this[ITER]});function createChainIterator(next){function Iter(I,fn,that){this[ITER]=getIterator(I);this[ENTRIES]=I[ENTRIES];this[FN]=ctx(fn,that,I[ENTRIES]?2:1)}createIterator(Iter,"Chain",next,$forProto);setIterator(Iter[PROTOTYPE],returnThis);return Iter}var MapIter=createChainIterator(function(){var step=this[ITER].next();return step.done?step:iterResult(0,stepCall(this[FN],step.value,this[ENTRIES]))});var FilterIter=createChainIterator(function(){for(;;){var step=this[ITER].next();if(step.done||stepCall(this[FN],step.value,this[ENTRIES]))return step}});assignHidden($forProto,{of:function(fn,that){forOf(this,this[ENTRIES],fn,that)},array:function(fn,that){var result=[];forOf(fn!=undefined?this.map(fn,that):this,false,push,result);return result},filter:function(fn,that){return new FilterIter(this,fn,that)},map:function(fn,that){return new MapIter(this,fn,that)}});$for.isIterable=isIterable;$for.getIterator=getIterator;$define(GLOBAL+FORCED,{$for:$for})}("entries",safeSymbol("fn"));$define(GLOBAL+FORCED,{delay:function(time){return new Promise(function(resolve){setTimeout(resolve,time,true)})}});!function(_,toLocaleString){core._=path._=path._||{};$define(PROTO+FORCED,FUNCTION,{part:part,only:function(numberArguments,that){var fn=assertFunction(this),n=toLength(numberArguments),isThat=arguments.length>1;return function(){var length=min(n,arguments.length),args=Array(length),i=0;while(length>i)args[i]=arguments[i++];return invoke(fn,args,isThat?that:this)}}});function tie(key){var that=this,bound={};return hidden(that,_,function(key){if(key===undefined||!(key in that))return toLocaleString.call(that);return has(bound,key)?bound[key]:bound[key]=ctx(that[key],that,-1)})[_](key)}hidden(path._,TO_STRING,function(){return _});hidden(ObjectProto,_,tie);DESC||hidden(ArrayProto,_,tie)}(DESC?uid("tie"):TO_LOCALE,ObjectProto[TO_LOCALE]);!function(){function define(target,mixin){var keys=ownKeys(toObject(mixin)),length=keys.length,i=0,key;while(length>i)defineProperty(target,key=keys[i++],getOwnDescriptor(mixin,key));return target}$define(STATIC+FORCED,OBJECT,{isObject:isObject,classof:classof,define:define,make:function(proto,mixin){return define(create(proto),mixin)}})}();$define(PROTO+FORCED,ARRAY,{turn:function(fn,target){assertFunction(fn);var memo=target==undefined?[]:Object(target),O=ES5Object(this),length=toLength(O.length),index=0;while(length>index)if(fn(memo,O[index],index++,this)===false)break;return memo}});if(framework)ArrayUnscopables.turn=true;!function(numberMethods){function NumberIterator(iterated){set(this,ITER,{l:toLength(iterated),i:0})}createIterator(NumberIterator,NUMBER,function(){var iter=this[ITER],i=iter.i++;return i<iter.l?iterResult(0,i):iterResult(1)});defineIterator(Number,NUMBER,function(){return new NumberIterator(this)});numberMethods.random=function(lim){var a=+this,b=lim==undefined?0:+lim,m=min(a,b);return random()*(max(a,b)-m)+m};forEach.call(array("round,floor,ceil,abs,sin,asin,cos,acos,tan,atan,exp,sqrt,max,min,pow,atan2,"+"acosh,asinh,atanh,cbrt,clz32,cosh,expm1,hypot,imul,log1p,log10,log2,sign,sinh,tanh,trunc"),function(key){var fn=Math[key];if(fn)numberMethods[key]=function(){var args=[+this],i=0;while(arguments.length>i)args.push(arguments[i++]);return invoke(fn,args)}});$define(PROTO+FORCED,NUMBER,numberMethods)}({});!function(){var escapeHTMLDict={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},unescapeHTMLDict={},key;for(key in escapeHTMLDict)unescapeHTMLDict[escapeHTMLDict[key]]=key;$define(PROTO+FORCED,STRING,{escapeHTML:createReplacer(/[&<>"']/g,escapeHTMLDict),unescapeHTML:createReplacer(/&(?:amp|lt|gt|quot|apos);/g,unescapeHTMLDict)})}();!function(formatRegExp,flexioRegExp,locales,current,SECONDS,MINUTES,HOURS,MONTH,YEAR){function createFormat(prefix){return function(template,locale){var that=this,dict=locales[has(locales,locale)?locale:current];function get(unit){return that[prefix+unit]()}return String(template).replace(formatRegExp,function(part){switch(part){case"s":return get(SECONDS);case"ss":return lz(get(SECONDS));case"m":return get(MINUTES);case"mm":return lz(get(MINUTES));case"h":return get(HOURS);case"hh":return lz(get(HOURS));case"D":return get(DATE);case"DD":return lz(get(DATE));case"W":return dict[0][get("Day")];case"N":return get(MONTH)+1;case"NN":return lz(get(MONTH)+1);case"M":return dict[2][get(MONTH)];case"MM":return dict[1][get(MONTH)];case"Y":return get(YEAR);case"YY":return lz(get(YEAR)%100)}return part})}}function addLocale(lang,locale){function split(index){var result=[];forEach.call(array(locale.months),function(it){result.push(it.replace(flexioRegExp,"$"+index))});return result}locales[lang]=[array(locale.weekdays),split(1),split(2)];return core}$define(PROTO+FORCED,DATE,{format:createFormat("get"),formatUTC:createFormat("getUTC")});addLocale(current,{weekdays:"Sunday,Monday,Tuesday,Wednesday,Thursday,Friday,Saturday",months:"January,February,March,April,May,June,July,August,September,October,November,December"});addLocale("ru",{weekdays:",,,,,,",months:":|,:|,:|,:|,:|,:|,"+":|,:|,:|,:|,:|,:|"});core.locale=function(locale){return has(locales,locale)?current=locale:current};core.addLocale=addLocale}(/\b\w\w?\b/g,/:(.*)\|(.*)$/,{},"en","Seconds","Minutes","Hours","Month","FullYear");$define(GLOBAL+FORCED,{global:global});!function(arrayStatics){function setArrayStatics(keys,length){forEach.call(array(keys),function(key){if(key in ArrayProto)arrayStatics[key]=ctx(call,ArrayProto[key],length)})}setArrayStatics("pop,reverse,shift,keys,values,entries",1);setArrayStatics("indexOf,every,some,forEach,map,filter,find,findIndex,includes",3);setArrayStatics("join,slice,concat,push,splice,unshift,sort,lastIndexOf,"+"reduce,reduceRight,copyWithin,fill,turn");$define(STATIC,ARRAY,arrayStatics)}({});!function(NodeList){if(framework&&NodeList&&!(SYMBOL_ITERATOR in NodeList[PROTOTYPE])){hidden(NodeList[PROTOTYPE],SYMBOL_ITERATOR,Iterators[ARRAY])}Iterators.NodeList=Iterators[ARRAY]}(global.NodeList);!function(log,enabled){forEach.call(array("assert,clear,count,debug,dir,dirxml,error,exception,"+"group,groupCollapsed,groupEnd,info,isIndependentlyComposed,log,"+"markTimeline,profile,profileEnd,table,time,timeEnd,timeline,"+"timelineEnd,timeStamp,trace,warn"),function(key){log[key]=function(){if(enabled&&key in console)return apply.call(console[key],console,arguments)}});$define(GLOBAL+FORCED,{log:assign(log.log,log,{enable:function(){enabled=true},disable:function(){enabled=false}})})}({},true)}(typeof self!="undefined"&&self.Math===Math?self:Function("return this")(),false);module.exports={"default":module.exports,__esModule:true}},{}],25:[function(require,module,exports){"use strict";exports["default"]=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};exports.__esModule=true},{}],26:[function(require,module,exports){"use strict";exports["default"]=function(){function defineProperties(target,props){for(var key in props){var prop=props[key];prop.configurable=true;if(prop.value)prop.writable=true}Object.defineProperties(target,props)}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();exports.__esModule=true},{}],27:[function(require,module,exports){"use strict";var _core=require("babel-runtime/core-js")["default"];exports["default"]=function get(_x,_x2,_x3){var _again=true;_function:while(_again){_again=false;var object=_x,property=_x2,receiver=_x3;desc=parent=getter=undefined;var desc=_core.Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=_core.Object.getPrototypeOf(object);if(parent===null){return undefined}else{_x=parent;_x2=property;_x3=receiver;_again=true;continue _function}}else if("value"in desc&&desc.writable){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}}};exports.__esModule=true},{"babel-runtime/core-js":24}],28:[function(require,module,exports){"use strict";exports["default"]=function(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)subClass.__proto__=superClass};exports.__esModule=true},{}],29:[function(require,module,exports){"use strict";var wavesAudio={audioContext:require("./dist/core/audio-context"),TimeEngine:require("./dist/core/time-engine"),AudioTimeEngine:require("./dist/core/audio-time-engine"),GranularEngine:require("./dist/engines/granular-engine"),Metronome:require("./dist/engines/metronome"),PlayerEngine:require("./dist/engines/player-engine"),SegmentEngine:require("./dist/engines/segment-engine"),PlayControl:require("./dist/masters/play-control"),Transport:require("./dist/masters/transport"),Scheduler:require("./dist/masters/scheduler"),SimpleScheduler:require("./dist/masters/simple-scheduler"),PriorityQueue:require("./dist/utils/priority-queue"),SchedulingQueue:require("./dist/utils/scheduling-queue"),getScheduler:require("./dist/masters/factories").getScheduler,getSimpleScheduler:require("./dist/masters/factories").getSimpleScheduler};module.exports=wavesAudio},{"./dist/core/audio-context":10,"./dist/core/audio-time-engine":11,"./dist/core/time-engine":12,"./dist/engines/granular-engine":13,"./dist/engines/metronome":14,"./dist/engines/player-engine":15,"./dist/engines/segment-engine":16,"./dist/masters/factories":17,"./dist/masters/play-control":18,"./dist/masters/scheduler":19,"./dist/masters/simple-scheduler":20,"./dist/masters/transport":21,"./dist/utils/priority-queue":22,"./dist/utils/scheduling-queue":23}]},{},[3]);